<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.63" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html"><meta property="og:site_name" content="huamus"><meta property="og:title" content="1. Redis æ•°æ®ç»“æ„"><meta property="og:description" content="Redis ä¸ºä»€ä¹ˆé‚£ä¹ˆå¿«ï¼Ÿ é™¤äº†å®ƒæ˜¯å†…å­˜æ•°æ®åº“ï¼Œä½¿å¾—æ‰€æœ‰çš„æ“ä½œéƒ½åœ¨å†…å­˜ä¸Šè¿›è¡Œä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦å› ç´ ï¼Œå®ƒå®ç°çš„æ•°æ®ç»“æ„ï¼Œä½¿å¾—æˆ‘ä»¬å¯¹æ•°æ®è¿›è¡Œå¢åˆ æŸ¥æ”¹æ“ä½œæ—¶ï¼ŒRedis èƒ½é«˜æ•ˆçš„å¤„ç†ã€‚ å› æ­¤ï¼Œè¿™æ¬¡æˆ‘ä»¬å°±æ¥å¥½å¥½èŠä¸€ä¸‹ Redis æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªåœ¨é¢è¯•ä¸­å¤ªå¸¸é—®äº†ã€‚ æ³¨æ„ï¼ŒRedis æ•°æ®ç»“æ„å¹¶ä¸æ˜¯æŒ‡ Stringï¼ˆå­—ç¬¦ä¸²ï¼‰å¯¹è±¡ã€Listï¼ˆåˆ—è¡¨ï¼‰å¯¹è±¡ã€Hashï¼ˆå“ˆå¸Œï¼‰å¯¹è±¡ã€Setï¼ˆé›†åˆï¼‰å¯¹è±¡å’Œ Zsetï¼ˆæœ‰åºé›†åˆï¼‰å¯¹è±¡ï¼Œå› ä¸ºè¿™äº›æ˜¯ Redis é”®å€¼å¯¹ä¸­å€¼çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿå°±æ˜¯æ•°æ®çš„ä¿å­˜å½¢å¼ï¼Œè¿™äº›å¯¹è±¡çš„åº•å±‚å®ç°çš„æ–¹å¼å°±ç”¨åˆ°äº†æ•°æ®ç»“æ„ã€‚"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-07-02T14:35:37.000Z"><meta property="article:author" content="huamus"><meta property="article:modified_time" content="2023-07-02T14:35:37.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"1. Redis æ•°æ®ç»“æ„","image":[""],"dateModified":"2023-07-02T14:35:37.000Z","author":[{"@type":"Person","name":"huamus","url":"https://huamus.github.io/mynotes/"}]}</script><title>1. Redis æ•°æ®ç»“æ„ | huamus</title><meta name="description" content="Redis ä¸ºä»€ä¹ˆé‚£ä¹ˆå¿«ï¼Ÿ é™¤äº†å®ƒæ˜¯å†…å­˜æ•°æ®åº“ï¼Œä½¿å¾—æ‰€æœ‰çš„æ“ä½œéƒ½åœ¨å†…å­˜ä¸Šè¿›è¡Œä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦å› ç´ ï¼Œå®ƒå®ç°çš„æ•°æ®ç»“æ„ï¼Œä½¿å¾—æˆ‘ä»¬å¯¹æ•°æ®è¿›è¡Œå¢åˆ æŸ¥æ”¹æ“ä½œæ—¶ï¼ŒRedis èƒ½é«˜æ•ˆçš„å¤„ç†ã€‚ å› æ­¤ï¼Œè¿™æ¬¡æˆ‘ä»¬å°±æ¥å¥½å¥½èŠä¸€ä¸‹ Redis æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªåœ¨é¢è¯•ä¸­å¤ªå¸¸é—®äº†ã€‚ æ³¨æ„ï¼ŒRedis æ•°æ®ç»“æ„å¹¶ä¸æ˜¯æŒ‡ Stringï¼ˆå­—ç¬¦ä¸²ï¼‰å¯¹è±¡ã€Listï¼ˆåˆ—è¡¨ï¼‰å¯¹è±¡ã€Hashï¼ˆå“ˆå¸Œï¼‰å¯¹è±¡ã€Setï¼ˆé›†åˆï¼‰å¯¹è±¡å’Œ Zsetï¼ˆæœ‰åºé›†åˆï¼‰å¯¹è±¡ï¼Œå› ä¸ºè¿™äº›æ˜¯ Redis é”®å€¼å¯¹ä¸­å€¼çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿå°±æ˜¯æ•°æ®çš„ä¿å­˜å½¢å¼ï¼Œè¿™äº›å¯¹è±¡çš„åº•å±‚å®ç°çš„æ–¹å¼å°±ç”¨åˆ°äº†æ•°æ®ç»“æ„ã€‚">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/myblogs/assets/style-2cface98.css" as="style"><link rel="stylesheet" href="/myblogs/assets/style-2cface98.css">
    <link rel="modulepreload" href="/myblogs/assets/app-88eaaf34.js"><link rel="modulepreload" href="/myblogs/assets/1.html-9bcf6c79.js"><link rel="modulepreload" href="/myblogs/assets/plugin-vue_export-helper-c27b6911.js"><link rel="modulepreload" href="/myblogs/assets/1.html-98026304.js"><link rel="prefetch" href="/myblogs/assets/index.html-81a9abfc.js" as="script"><link rel="prefetch" href="/myblogs/assets/intro.html-39e1e0a4.js" as="script"><link rel="prefetch" href="/myblogs/assets/slides.html-f9c5ab45.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-cae7638a.js" as="script"><link rel="prefetch" href="/myblogs/assets/cherry.html-769df765.js" as="script"><link rel="prefetch" href="/myblogs/assets/dragonfruit.html-e2a519c9.js" as="script"><link rel="prefetch" href="/myblogs/assets/strawberry.html-93f7e257.js" as="script"><link rel="prefetch" href="/myblogs/assets/tomato.html-e0e91a03.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-0dc9baf3.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-29d1515a.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-7793269b.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-492d79ef.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-5df1d006.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.html-3029e763.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.html-325f717e.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-b2d9e17d.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-ba84b8fc.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.html-4e600dec.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.html-4c0e32a3.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-916b651c.js" as="script"><link rel="prefetch" href="/myblogs/assets/IntruductionToSpringAOPUsage.html-dd28f4c4.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-11a57666.js" as="script"><link rel="prefetch" href="/myblogs/assets/SpringAOPSourceCodeParsing.html-e6e82807.js" as="script"><link rel="prefetch" href="/myblogs/assets/SpringIOCContainerSourceCodeAnalysis.html-9518d844.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-d10e2315.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-724da181.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-de6c2376.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-668acac8.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-2954cf3e.js" as="script"><link rel="prefetch" href="/myblogs/assets/designPatternCanBeSimple.html-e252c176.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.1.html-c3b017d1.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-9178650a.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.1.html-a1fb27c2.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.2.html-65da77f5.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-d20035e3.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.1.html-53dd567a.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.8.html-c3b51598.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.9.html-1fcf0590.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-892fe4cd.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.1.html-2787f9da.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.2.html-30671040.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-7423c168.js" as="script"><link rel="prefetch" href="/myblogs/assets/5.1.html-3059b86c.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-013d588a.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.1.html-f7c0a62c.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-6645ae24.js" as="script"><link rel="prefetch" href="/myblogs/assets/10.1.html-412a41ce.js" as="script"><link rel="prefetch" href="/myblogs/assets/10.2.html-d646637a.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-4f8e5cd2.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.4.html-7b4110b8.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.6.html-2d4cf2af.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-90252028.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.1.html-0f3f5939.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-dcb6ebd7.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.1.html-02bbe131.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.2.html-34f4a0f9.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.3.html-5047725f.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.5.html-bc88c5c5.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-fd8bf4d0.js" as="script"><link rel="prefetch" href="/myblogs/assets/5.1.html-2236f073.js" as="script"><link rel="prefetch" href="/myblogs/assets/5.2.html-d30190a5.js" as="script"><link rel="prefetch" href="/myblogs/assets/5.3.html-e08f8107.js" as="script"><link rel="prefetch" href="/myblogs/assets/5.4.html-3b77137e.js" as="script"><link rel="prefetch" href="/myblogs/assets/5.5.html-f45d40e6.js" as="script"><link rel="prefetch" href="/myblogs/assets/5.7.html-f6e5bc71.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-22fd464a.js" as="script"><link rel="prefetch" href="/myblogs/assets/6.1.html-5c8e8185.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-830351f1.js" as="script"><link rel="prefetch" href="/myblogs/assets/7.1.html-665ffa89.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-b8237bd0.js" as="script"><link rel="prefetch" href="/myblogs/assets/9.1.html-2209aca4.js" as="script"><link rel="prefetch" href="/myblogs/assets/9.2.html-11213097.js" as="script"><link rel="prefetch" href="/myblogs/assets/9.3.html-29c43d1d.js" as="script"><link rel="prefetch" href="/myblogs/assets/9.4.html-92961a25.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-d842ff69.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-eaeded9a.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-388051d0.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-476271fa.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-22fdaadd.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-1fa9d7b4.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-a78dc621.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-9d62c95c.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.html-3e63b358.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.html-50ab4ea3.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-ac930b6f.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-14513775.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-e93d7c2c.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-f0fffb76.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-700ff5b8.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-829ed06a.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.html-d699a774.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.html-2c6b23fa.js" as="script"><link rel="prefetch" href="/myblogs/assets/5.html-5c18577f.js" as="script"><link rel="prefetch" href="/myblogs/assets/6.html-b4ac8a3f.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-82b76e15.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-8830ddf4.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-6295ee2f.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-db2dbcfc.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-e6e12a2e.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-92a58ebf.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-41e57843.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-7e98bed9.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-413fa225.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-4c6084d1.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-8829ca52.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-a3981e06.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-225dc381.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.html-f96b4626.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-eddbe98c.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-68469716.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-16d12d89.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-17f897d5.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-75f89789.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-6827ecf9.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-d866d77d.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-8f9906f4.js" as="script"><link rel="prefetch" href="/myblogs/assets/404.html-60ca5acc.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-9b073a3d.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-45148ec4.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-ca10271f.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-c41bb8f4.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-a0b85eba.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-9a60e4a5.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-cbeb7b6a.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-4ff53da1.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-f305087c.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-c5c94a40.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-bcef72aa.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-e16aa354.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-06f06129.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-92031ff6.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-de5593b9.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-01770171.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-28abb7cd.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-a4bb4b2c.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-ad18ea4f.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-72a4a0bb.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-1d0864ff.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-44aa827d.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-a3ec2d8a.js" as="script"><link rel="prefetch" href="/myblogs/assets/intro.html-a192d25e.js" as="script"><link rel="prefetch" href="/myblogs/assets/slides.html-5838dd47.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-8698edb2.js" as="script"><link rel="prefetch" href="/myblogs/assets/cherry.html-dd3d6052.js" as="script"><link rel="prefetch" href="/myblogs/assets/dragonfruit.html-e73cbde3.js" as="script"><link rel="prefetch" href="/myblogs/assets/strawberry.html-082f0e40.js" as="script"><link rel="prefetch" href="/myblogs/assets/tomato.html-b85a0e1d.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-b2118e35.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-9ea49646.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-94c38778.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-7f8f8d29.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-c9908644.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.html-062753ec.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.html-d8450c45.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-d89ad4f1.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-3fd4c2e5.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.html-f41281d3.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.html-f912a0d4.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-31996d71.js" as="script"><link rel="prefetch" href="/myblogs/assets/IntruductionToSpringAOPUsage.html-e23ef00c.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-72386410.js" as="script"><link rel="prefetch" href="/myblogs/assets/SpringAOPSourceCodeParsing.html-97ec9e35.js" as="script"><link rel="prefetch" href="/myblogs/assets/SpringIOCContainerSourceCodeAnalysis.html-b7364ab2.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-3aa9461f.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-53ae255b.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-76c43b5a.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-1dc7e594.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-970bfa26.js" as="script"><link rel="prefetch" href="/myblogs/assets/designPatternCanBeSimple.html-5f7afbf4.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.1.html-9ff4f6b6.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-c6b740d8.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.1.html-4a817f55.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.2.html-063f853c.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-a0e59277.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.1.html-d20f43fa.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.8.html-a18fcfe7.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.9.html-8d1e0381.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-9143aac9.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.1.html-66434164.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.2.html-6812ad3d.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-41e2b5ad.js" as="script"><link rel="prefetch" href="/myblogs/assets/5.1.html-9ae3d7b4.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-5e3adc0c.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.1.html-8d3b1c34.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-a671106c.js" as="script"><link rel="prefetch" href="/myblogs/assets/10.1.html-fb1efd31.js" as="script"><link rel="prefetch" href="/myblogs/assets/10.2.html-828d527b.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-36992f61.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.4.html-d65612f3.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.6.html-1954f4ab.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-0a21edb0.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.1.html-c83e8b90.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-cf81caeb.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.1.html-bbbc129f.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.2.html-2b5c437b.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.3.html-12d4e887.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.5.html-8b993c70.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-027e1126.js" as="script"><link rel="prefetch" href="/myblogs/assets/5.1.html-78806060.js" as="script"><link rel="prefetch" href="/myblogs/assets/5.2.html-fdba483b.js" as="script"><link rel="prefetch" href="/myblogs/assets/5.3.html-025c80a6.js" as="script"><link rel="prefetch" href="/myblogs/assets/5.4.html-f17e700b.js" as="script"><link rel="prefetch" href="/myblogs/assets/5.5.html-76d44a27.js" as="script"><link rel="prefetch" href="/myblogs/assets/5.7.html-b49c8a9e.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-7eedc80e.js" as="script"><link rel="prefetch" href="/myblogs/assets/6.1.html-d93e3a9e.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-f5374b0d.js" as="script"><link rel="prefetch" href="/myblogs/assets/7.1.html-0de8d471.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-fa5e0f29.js" as="script"><link rel="prefetch" href="/myblogs/assets/9.1.html-259f83bc.js" as="script"><link rel="prefetch" href="/myblogs/assets/9.2.html-9dbd3321.js" as="script"><link rel="prefetch" href="/myblogs/assets/9.3.html-aaca8423.js" as="script"><link rel="prefetch" href="/myblogs/assets/9.4.html-faf8075e.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-b5f02e60.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-95591bce.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-ccbb5d63.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-ba2bb46a.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-d626c453.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-35cc8e85.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-665a1e29.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-8e680074.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.html-ea770f5b.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.html-c006c9f8.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-97e692d3.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-e854c2c7.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-1e507d9d.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-75e337b4.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-c281e5ef.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-999eb12e.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.html-725605b3.js" as="script"><link rel="prefetch" href="/myblogs/assets/4.html-e95667b2.js" as="script"><link rel="prefetch" href="/myblogs/assets/5.html-8f69933e.js" as="script"><link rel="prefetch" href="/myblogs/assets/6.html-33511a2a.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-56ac1c47.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-495e92cd.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-e15fd026.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-5ec5cf45.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-597c4a43.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-640d86df.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-cee6c7f4.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-9ff06165.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-ec1096a3.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-7fa31679.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-0e3f230d.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-3c9af2fc.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-cbe1460f.js" as="script"><link rel="prefetch" href="/myblogs/assets/3.html-221a05b9.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-03f05545.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-3b05898a.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-46590d2e.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-28fda6d2.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-5ce6afe7.js" as="script"><link rel="prefetch" href="/myblogs/assets/1.html-1fc56f0a.js" as="script"><link rel="prefetch" href="/myblogs/assets/2.html-6dcc3baa.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-b60ff236.js" as="script"><link rel="prefetch" href="/myblogs/assets/404.html-db0a4af6.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-1a64b786.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-3a1bce0a.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-53ad3807.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-978041a0.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-2508fe5e.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-3d3a3b3f.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-f99c2bb6.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-0160fa25.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-853f120b.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-0b252d99.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-a8fe8712.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-9e6910bd.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-db411aa9.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-4fd9f48e.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-04c88edb.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-bdb055bb.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-61e6238d.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-c97f1440.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-d04b002b.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-265ca965.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-e152190d.js" as="script"><link rel="prefetch" href="/myblogs/assets/index.html-ae2a7196.js" as="script"><link rel="prefetch" href="/myblogs/assets/waline-meta-a31b78ed.js" as="script"><link rel="prefetch" href="/myblogs/assets/component-c1b1ce69.js" as="script"><link rel="prefetch" href="/myblogs/assets/auto-fa8841cf.js" as="script"><link rel="prefetch" href="/myblogs/assets/index-ae8c1e74.js" as="script"><link rel="prefetch" href="/myblogs/assets/flowchart-d65a1d8e.js" as="script"><link rel="prefetch" href="/myblogs/assets/mermaid.core-645373ef.js" as="script"><link rel="prefetch" href="/myblogs/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/myblogs/assets/markdown.esm-0191f9da.js" as="script"><link rel="prefetch" href="/myblogs/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/myblogs/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/myblogs/assets/reveal.esm-ec5549c1.js" as="script"><link rel="prefetch" href="/myblogs/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/myblogs/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/myblogs/assets/VuePlayground-05230916.js" as="script"><link rel="prefetch" href="/myblogs/assets/photoswipe.esm-2450701e.js" as="script"><link rel="prefetch" href="/myblogs/assets/pageview-a5d1b19a.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar hide-icon"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand" href="/myblogs/"><img class="vp-nav-logo" src="https://huamus.github.io/mynotes/logo.jpg" alt="huamus"><!----><span class="vp-site-name hide-in-pad">huamus</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="vp-link nav-link" href="/myblogs/"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>åšå®¢ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="çŸ¥è¯†åº“"><span class="title"><!---->çŸ¥è¯†åº“</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/myblogs/knowledgeBase/JavaCompanion/"><!---->java æŒ‡å—<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link active" href="/myblogs/knowledgeBase/xiaolinCoding/"><!---->å°æ—codingæ•´ç†ç‰ˆ<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="åšæ–‡"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>åšæ–‡</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>è‹¹æœ</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/myblogs/posts/apple/1.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>è‹¹æœ1<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link" href="/myblogs/posts/apple/2.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>è‹¹æœ2<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link" href="/myblogs/posts/apple/3.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>è‹¹æœ 3<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link" href="/myblogs/posts/apple/4.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>è‹¹æœ 4<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>é¦™è•‰</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/myblogs/posts/banana/1.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>é¦™è•‰ 1<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link" href="/myblogs/posts/banana/2.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>é¦™è•‰ 2<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link" href="/myblogs/posts/banana/3.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>é¦™è•‰ 3<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link" href="/myblogs/posts/banana/4.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>é¦™è•‰ 4<!----></a></li></ul></li><li class="dropdown-item"><a class="vp-link nav-link" href="/myblogs/posts/cherry.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>æ¨±æ¡ƒ<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/myblogs/posts/dragonfruit.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>ç«é¾™æœ<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/myblogs/posts/tomato.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>ç•ªèŒ„<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/myblogs/posts/strawberry.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>è‰è“<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://theme-hope.vuejs.press/zh/" rel="noopener noreferrer" target="_blank" aria-label="V2 æ–‡æ¡£" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>V2 æ–‡æ¡£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">å°æ—codingæ•´ç†ç‰ˆ</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">è®¡ç®—æœºç½‘ç»œ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">æ“ä½œç³»ç»Ÿ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">MySQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">Redis</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">ä¸€ã€å‰è¨€</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">äºŒã€é¢è¯•ç¯‡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">ä¸‰ã€æ•°æ®ç±»å‹ç¯‡</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html"><!---->1. Redis æ•°æ®ç»“æ„<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#c-è¯­è¨€å­—ç¬¦ä¸²çš„ç¼ºé™·"><!---->C è¯­è¨€å­—ç¬¦ä¸²çš„ç¼ºé™·<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#sds-ç»“æ„è®¾è®¡"><!---->SDS ç»“æ„è®¾è®¡<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#o-1-å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦"><!---->Oï¼ˆ1ï¼‰å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#äºŒè¿›åˆ¶å®‰å…¨"><!---->äºŒè¿›åˆ¶å®‰å…¨<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#ä¸ä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡º"><!---->ä¸ä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡º<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#èŠ‚çœå†…å­˜ç©ºé—´"><!---->èŠ‚çœå†…å­˜ç©ºé—´<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#é“¾è¡¨èŠ‚ç‚¹ç»“æ„è®¾è®¡"><!---->é“¾è¡¨èŠ‚ç‚¹ç»“æ„è®¾è®¡<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#é“¾è¡¨ç»“æ„è®¾è®¡"><!---->é“¾è¡¨ç»“æ„è®¾è®¡<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#é“¾è¡¨çš„ä¼˜åŠ¿ä¸ç¼ºé™·"><!---->é“¾è¡¨çš„ä¼˜åŠ¿ä¸ç¼ºé™·<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#å‹ç¼©åˆ—è¡¨ç»“æ„è®¾è®¡"><!---->å‹ç¼©åˆ—è¡¨ç»“æ„è®¾è®¡<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#è¿é”æ›´æ–°"><!---->è¿é”æ›´æ–°<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#å‹ç¼©åˆ—è¡¨çš„ç¼ºé™·"><!---->å‹ç¼©åˆ—è¡¨çš„ç¼ºé™·<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#å“ˆå¸Œè¡¨ç»“æ„è®¾è®¡"><!---->å“ˆå¸Œè¡¨ç»“æ„è®¾è®¡<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#å“ˆå¸Œå†²çª"><!---->å“ˆå¸Œå†²çª<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#é“¾å¼å“ˆå¸Œ"><!---->é“¾å¼å“ˆå¸Œ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#rehash"><!---->rehash<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#æ¸è¿›å¼-rehash"><!---->æ¸è¿›å¼ rehash<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#rehash-è§¦å‘æ¡ä»¶"><!---->rehash è§¦å‘æ¡ä»¶<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#æ•´æ•°é›†åˆç»“æ„è®¾è®¡"><!---->æ•´æ•°é›†åˆç»“æ„è®¾è®¡<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#æ•´æ•°é›†åˆçš„å‡çº§æ“ä½œ"><!---->æ•´æ•°é›†åˆçš„å‡çº§æ“ä½œ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#è·³è¡¨ç»“æ„è®¾è®¡"><!---->è·³è¡¨ç»“æ„è®¾è®¡<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#è·³è¡¨èŠ‚ç‚¹æŸ¥è¯¢è¿‡ç¨‹"><!---->è·³è¡¨èŠ‚ç‚¹æŸ¥è¯¢è¿‡ç¨‹<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#è·³è¡¨èŠ‚ç‚¹å±‚æ•°è®¾ç½®"><!---->è·³è¡¨èŠ‚ç‚¹å±‚æ•°è®¾ç½®<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘"><!---->ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#quicklist-ç»“æ„è®¾è®¡"><!---->quicklist ç»“æ„è®¾è®¡<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html#listpack-ç»“æ„è®¾è®¡"><!---->listpack ç»“æ„è®¾è®¡<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/2.html"><!---->2. Redis å¸¸è§æ•°æ®ç±»å‹å’Œåº”ç”¨åœºæ™¯<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">å››ã€æŒä¹…åŒ–ç¯‡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">äº”ã€åŠŸèƒ½ç¯‡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">å…­ã€é«˜å¯ç”¨ç¯‡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">ä¸ƒã€ç¼“å­˜ç¯‡</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">java æŒ‡å—</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">æŠ€æœ¯æ–‡ç« æ‘˜å½•</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->1. Redis æ•°æ®ç»“æ„</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://huamus.github.io/mynotes/" target="_blank" rel="noopener noreferrer">huamus</a></span><span property="author" content="huamus"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-07-02T14:35:37.000Z"></span><span class="page-pageview-info" aria-label="è®¿é—®é‡ğŸ”¢" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span id="ArtalkPV" class="waline-pageview-count" data-path="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.html">...</span></span><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 50 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT50M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#c-è¯­è¨€å­—ç¬¦ä¸²çš„ç¼ºé™·">C è¯­è¨€å­—ç¬¦ä¸²çš„ç¼ºé™·</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#sds-ç»“æ„è®¾è®¡">SDS ç»“æ„è®¾è®¡</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/myblogs/#o-1-å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦">Oï¼ˆ1ï¼‰å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/myblogs/#äºŒè¿›åˆ¶å®‰å…¨">äºŒè¿›åˆ¶å®‰å…¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/myblogs/#ä¸ä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡º">ä¸ä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡º</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/myblogs/#èŠ‚çœå†…å­˜ç©ºé—´">èŠ‚çœå†…å­˜ç©ºé—´</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#é“¾è¡¨èŠ‚ç‚¹ç»“æ„è®¾è®¡">é“¾è¡¨èŠ‚ç‚¹ç»“æ„è®¾è®¡</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#é“¾è¡¨ç»“æ„è®¾è®¡">é“¾è¡¨ç»“æ„è®¾è®¡</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#é“¾è¡¨çš„ä¼˜åŠ¿ä¸ç¼ºé™·">é“¾è¡¨çš„ä¼˜åŠ¿ä¸ç¼ºé™·</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#å‹ç¼©åˆ—è¡¨ç»“æ„è®¾è®¡">å‹ç¼©åˆ—è¡¨ç»“æ„è®¾è®¡</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#è¿é”æ›´æ–°">è¿é”æ›´æ–°</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#å‹ç¼©åˆ—è¡¨çš„ç¼ºé™·">å‹ç¼©åˆ—è¡¨çš„ç¼ºé™·</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#å“ˆå¸Œè¡¨ç»“æ„è®¾è®¡">å“ˆå¸Œè¡¨ç»“æ„è®¾è®¡</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#å“ˆå¸Œå†²çª">å“ˆå¸Œå†²çª</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#é“¾å¼å“ˆå¸Œ">é“¾å¼å“ˆå¸Œ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#rehash">rehash</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#æ¸è¿›å¼-rehash">æ¸è¿›å¼ rehash</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#rehash-è§¦å‘æ¡ä»¶">rehash è§¦å‘æ¡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#æ•´æ•°é›†åˆç»“æ„è®¾è®¡">æ•´æ•°é›†åˆç»“æ„è®¾è®¡</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/myblogs/#æ•´æ•°é›†åˆçš„å‡çº§æ“ä½œ">æ•´æ•°é›†åˆçš„å‡çº§æ“ä½œ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#è·³è¡¨ç»“æ„è®¾è®¡">è·³è¡¨ç»“æ„è®¾è®¡</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#è·³è¡¨èŠ‚ç‚¹æŸ¥è¯¢è¿‡ç¨‹">è·³è¡¨èŠ‚ç‚¹æŸ¥è¯¢è¿‡ç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#è·³è¡¨èŠ‚ç‚¹å±‚æ•°è®¾ç½®">è·³è¡¨èŠ‚ç‚¹å±‚æ•°è®¾ç½®</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘">ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#quicklist-ç»“æ„è®¾è®¡">quicklist ç»“æ„è®¾è®¡</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/myblogs/#listpack-ç»“æ„è®¾è®¡">listpack ç»“æ„è®¾è®¡</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><p><strong>Redis ä¸ºä»€ä¹ˆé‚£ä¹ˆå¿«ï¼Ÿ</strong></p><p>é™¤äº†å®ƒæ˜¯å†…å­˜æ•°æ®åº“ï¼Œä½¿å¾—æ‰€æœ‰çš„æ“ä½œéƒ½åœ¨å†…å­˜ä¸Šè¿›è¡Œä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦å› ç´ ï¼Œå®ƒå®ç°çš„æ•°æ®ç»“æ„ï¼Œä½¿å¾—æˆ‘ä»¬å¯¹æ•°æ®è¿›è¡Œå¢åˆ æŸ¥æ”¹æ“ä½œæ—¶ï¼ŒRedis èƒ½é«˜æ•ˆçš„å¤„ç†ã€‚</p><p>å› æ­¤ï¼Œè¿™æ¬¡æˆ‘ä»¬å°±æ¥å¥½å¥½èŠä¸€ä¸‹ Redis æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªåœ¨é¢è¯•ä¸­å¤ªå¸¸é—®äº†ã€‚</p><p>æ³¨æ„ï¼Œ<strong>Redis æ•°æ®ç»“æ„å¹¶ä¸æ˜¯æŒ‡ Stringï¼ˆå­—ç¬¦ä¸²ï¼‰å¯¹è±¡ã€Listï¼ˆåˆ—è¡¨ï¼‰å¯¹è±¡ã€Hashï¼ˆå“ˆå¸Œï¼‰å¯¹è±¡ã€Setï¼ˆé›†åˆï¼‰å¯¹è±¡å’Œ Zsetï¼ˆæœ‰åºé›†åˆï¼‰å¯¹è±¡ï¼Œå› ä¸ºè¿™äº›æ˜¯ Redis é”®å€¼å¯¹ä¸­å€¼çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿå°±æ˜¯æ•°æ®çš„ä¿å­˜å½¢å¼ï¼Œè¿™äº›å¯¹è±¡çš„åº•å±‚å®ç°çš„æ–¹å¼å°±ç”¨åˆ°äº†æ•°æ®ç»“æ„</strong>ã€‚</p><p>æˆ‘ç”»äº†ä¸€å¼  Redis æ•°æ®ç±»å‹ï¼ˆä¹Ÿå« Redis å¯¹è±¡ï¼‰å’Œåº•å±‚æ•°æ®ç»“æ„çš„å¯¹åº”å…³å›¾ï¼Œå·¦è¾¹æ˜¯ Redis 3.0ç‰ˆæœ¬çš„ï¼Œä¹Ÿå°±æ˜¯ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹è¿™æœ¬ä¹¦è®²è§£çš„ç‰ˆæœ¬ï¼Œç°åœ¨çœ‹è¿˜æ˜¯æœ‰ç‚¹è¿‡æ—¶äº†ï¼Œå³è¾¹æ˜¯ç°åœ¨ Github æœ€æ–°çš„ Redis ä»£ç çš„ï¼ˆè¿˜æœªå‘å¸ƒæ­£å¼ç‰ˆæœ¬ï¼‰ã€‚</p><figure><img src="https://cdn.nlark.com/yuque/0/2023/png/25684216/1684680945646-d88a2784-332e-4944-adb7-f66328ae4141.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼ŒRedis æ•°æ®ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„éšç€ç‰ˆæœ¬çš„æ›´æ–°ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œæ¯”å¦‚ï¼š</p><ul><li>åœ¨ Redis 3.0 ç‰ˆæœ¬ä¸­ List å¯¹è±¡çš„åº•å±‚æ•°æ®ç»“æ„ç”±ã€ŒåŒå‘é“¾è¡¨ã€æˆ–ã€Œå‹ç¼©è¡¨åˆ—è¡¨ã€å®ç°ï¼Œä½†æ˜¯åœ¨ 3.2 ç‰ˆæœ¬ä¹‹åï¼ŒList æ•°æ®ç±»å‹åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”± quicklist å®ç°çš„ï¼›</li><li>åœ¨æœ€æ–°çš„ Redis ä»£ç ï¼ˆè¿˜æœªå‘å¸ƒæ­£å¼ç‰ˆæœ¬ï¼‰ä¸­ï¼Œå‹ç¼©åˆ—è¡¨æ•°æ®ç»“æ„å·²ç»åºŸå¼ƒäº†ï¼Œäº¤ç”± listpack æ•°æ®ç»“æ„æ¥å®ç°äº†ã€‚</li></ul><p><strong>è¿™æ¬¡ï¼Œå°æ—æŠŠæ–°æ—§ç‰ˆæœ¬çš„æ•°æ®ç»“æ„è¯´å›¾è§£ä¸€éï¼Œå…±æœ‰ 9 ç§æ•°æ®ç»“æ„ï¼šSDSã€åŒå‘é“¾è¡¨ã€å‹ç¼©åˆ—è¡¨ã€å“ˆå¸Œè¡¨ã€è·³è¡¨ã€æ•´æ•°é›†åˆã€quicklistã€listpackã€‚</strong></p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020723756.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h1 id="é”®å€¼å¯¹æ•°æ®åº“æ˜¯æ€ä¹ˆå®ç°çš„" tabindex="-1"><a class="header-anchor" href="#é”®å€¼å¯¹æ•°æ®åº“æ˜¯æ€ä¹ˆå®ç°çš„" aria-hidden="true">#</a> é”®å€¼å¯¹æ•°æ®åº“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h1><p>åœ¨å¼€å§‹è®²æ•°æ®ç»“æ„ä¹‹å‰ï¼Œå…ˆç»™ä»‹ç»ä¸‹ Redis æ˜¯æ€æ ·å®ç°é”®å€¼å¯¹ï¼ˆkey-valueï¼‰æ•°æ®åº“çš„ã€‚</p><p>Redis çš„é”®å€¼å¯¹ä¸­çš„ key å°±æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ï¼Œè€Œ <strong>value å¯ä»¥æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯é›†åˆæ•°æ®ç±»å‹çš„å¯¹è±¡</strong>ï¼Œæ¯”å¦‚ List å¯¹è±¡ã€Hash å¯¹è±¡ã€Set å¯¹è±¡å’Œ Zset å¯¹è±¡ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘è¿™é‡Œåˆ—å‡ºå‡ ç§ Redis æ–°å¢é”®å€¼å¯¹çš„å‘½ä»¤ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain"><pre class="language-plain"><code>&gt; SET name &quot;xiaolincoding&quot;
OK

&gt; HSET person name &quot;xiaolincoding&quot; age 18
0

&gt; RPUSH stu &quot;xiaolin&quot; &quot;xiaomei&quot;
(integer) 4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™äº›å‘½ä»¤ä»£è¡¨ç€ï¼š</p><ul><li>ç¬¬ä¸€æ¡å‘½ä»¤ï¼šname æ˜¯ä¸€ä¸ª<strong>å­—ç¬¦ä¸²é”®</strong>ï¼Œå› ä¸ºé”®çš„<strong>å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</strong>ï¼›</li><li>ç¬¬äºŒæ¡å‘½ä»¤ï¼šperson æ˜¯ä¸€ä¸ª<strong>å“ˆå¸Œè¡¨é”®</strong>ï¼Œå› ä¸ºé”®çš„<strong>å€¼æ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªé”®å€¼å¯¹çš„å“ˆå¸Œè¡¨å¯¹è±¡</strong>ï¼›</li><li>ç¬¬ä¸‰æ¡å‘½ä»¤ï¼šstu æ˜¯ä¸€ä¸ª<strong>åˆ—è¡¨é”®</strong>ï¼Œå› ä¸ºé”®çš„<strong>å€¼æ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„åˆ—è¡¨å¯¹è±¡</strong>ï¼›</li></ul><p>è¿™äº›é”®å€¼å¯¹æ˜¯å¦‚ä½•ä¿å­˜åœ¨ Redis ä¸­çš„å‘¢ï¼Ÿ</p><p><strong>Redis æ˜¯ä½¿ç”¨äº†ä¸€ä¸ªã€Œå“ˆå¸Œè¡¨ã€ä¿å­˜æ‰€æœ‰é”®å€¼å¯¹ï¼Œå“ˆå¸Œè¡¨çš„æœ€å¤§å¥½å¤„å°±æ˜¯è®©æˆ‘ä»¬å¯ä»¥ç”¨ O(1) çš„æ—¶é—´å¤æ‚åº¦æ¥å¿«é€ŸæŸ¥æ‰¾åˆ°é”®å€¼å¯¹ã€‚å“ˆå¸Œè¡¨å…¶å®å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ å«åšå“ˆå¸Œæ¡¶ã€‚</strong></p><p>Redis çš„å“ˆå¸Œæ¡¶æ˜¯æ€ä¹ˆä¿å­˜é”®å€¼å¯¹æ•°æ®çš„å‘¢ï¼Ÿ</p><p><strong>å“ˆå¸Œæ¡¶å­˜æ”¾çš„æ˜¯æŒ‡å‘é”®å€¼å¯¹æ•°æ®çš„æŒ‡é’ˆï¼ˆdictEntry*ï¼‰ï¼Œè¿™æ ·é€šè¿‡æŒ‡é’ˆå°±èƒ½æ‰¾åˆ°é”®å€¼å¯¹æ•°æ®ï¼Œç„¶åå› ä¸ºé”®å€¼å¯¹çš„å€¼å¯ä»¥ä¿å­˜å­—ç¬¦ä¸²å¯¹è±¡å’Œé›†åˆæ•°æ®ç±»å‹çš„å¯¹è±¡ï¼Œæ‰€ä»¥é”®å€¼å¯¹çš„æ•°æ®ç»“æ„ä¸­å¹¶ä¸æ˜¯ç›´æ¥ä¿å­˜å€¼æœ¬èº«ï¼Œè€Œæ˜¯ä¿å­˜äº† void * key å’Œ void * value æŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘äº†å®é™…çš„é”®å¯¹è±¡å’Œå€¼å¯¹è±¡ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå³ä½¿å€¼æ˜¯é›†åˆæ•°æ®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ void * value æŒ‡é’ˆæ‰¾åˆ°ã€‚</strong></p><p>æˆ‘è¿™é‡Œç”»äº†ä¸€å¼  Redis ä¿å­˜é”®å€¼å¯¹æ‰€æ¶‰åŠåˆ°çš„æ•°æ®ç»“æ„ã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020723740.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>è¿™äº›æ•°æ®ç»“æ„çš„å†…éƒ¨ç»†èŠ‚ï¼Œæˆ‘å…ˆä¸å±•å¼€è®²ï¼Œåé¢åœ¨è®²å“ˆå¸Œè¡¨æ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œåœ¨è¯¦ç»†çš„è¯´è¯´ï¼Œå› ä¸ºç”¨åˆ°çš„æ•°æ®ç»“æ„æ˜¯ä¸€æ ·çš„ã€‚è¿™é‡Œå…ˆå¤§æ¦‚è¯´ä¸‹å›¾ä¸­æ¶‰åŠåˆ°çš„æ•°æ®ç»“æ„çš„åå­—å’Œç”¨é€”ï¼š</p><ul><li>redisDb ç»“æ„ï¼Œè¡¨ç¤º Redis æ•°æ®åº“çš„ç»“æ„ï¼Œç»“æ„ä½“é‡Œå­˜æ”¾äº†æŒ‡å‘äº† dict ç»“æ„çš„æŒ‡é’ˆï¼›</li><li>dict ç»“æ„ï¼Œç»“æ„ä½“é‡Œå­˜æ”¾äº† 2 ä¸ªå“ˆå¸Œè¡¨ï¼Œæ­£å¸¸æƒ…å†µä¸‹éƒ½æ˜¯ç”¨ã€Œå“ˆå¸Œè¡¨1ã€ï¼Œã€Œå“ˆå¸Œè¡¨2ã€åªæœ‰åœ¨ rehash çš„æ—¶å€™æ‰ç”¨ï¼Œå…·ä½“ä»€ä¹ˆæ˜¯ rehashï¼Œæˆ‘åœ¨æœ¬æ–‡çš„å“ˆå¸Œè¡¨æ•°æ®ç»“æ„ä¼šè®²ï¼›</li><li>ditctht ç»“æ„ï¼Œè¡¨ç¤ºå“ˆå¸Œè¡¨çš„ç»“æ„ï¼Œç»“æ„é‡Œå­˜æ”¾äº†å“ˆå¸Œè¡¨æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ç»“æ„ï¼ˆdictEntryï¼‰çš„æŒ‡é’ˆï¼›</li><li>dictEntry ç»“æ„ï¼Œè¡¨ç¤ºå“ˆå¸Œè¡¨èŠ‚ç‚¹çš„ç»“æ„ï¼Œç»“æ„é‡Œå­˜æ”¾äº† **void * key å’Œ void * value æŒ‡é’ˆï¼Œ <em>key æŒ‡å‘çš„æ˜¯ String å¯¹è±¡ï¼Œè€Œ</em> <em>value åˆ™å¯ä»¥æŒ‡å‘ String å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æŒ‡å‘é›†åˆç±»å‹çš„å¯¹è±¡ï¼Œæ¯”å¦‚ List å¯¹è±¡ã€Hash å¯¹è±¡ã€Set å¯¹è±¡å’Œ Zset å¯¹è±¡</em>ã€‚</li></ul><p>ç‰¹åˆ«è¯´æ˜ä¸‹ï¼Œvoid * key å’Œ void * value æŒ‡é’ˆæŒ‡å‘çš„æ˜¯ <strong>Redis å¯¹è±¡</strong>ï¼ŒRedis ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½ç”± redisObject ç»“æ„è¡¨ç¤ºï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020723699.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¯¹è±¡ç»“æ„é‡ŒåŒ…å«çš„æˆå‘˜å˜é‡ï¼š</p><ul><li>typeï¼Œæ ‡è¯†è¯¥å¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹çš„å¯¹è±¡ï¼ˆString å¯¹è±¡ã€ List å¯¹è±¡ã€Hash å¯¹è±¡ã€Set å¯¹è±¡å’Œ Zset å¯¹è±¡ï¼‰ï¼›</li><li>encodingï¼Œæ ‡è¯†è¯¥å¯¹è±¡ä½¿ç”¨äº†å“ªç§åº•å±‚çš„æ•°æ®ç»“æ„ï¼›</li><li><strong>ptrï¼ŒæŒ‡å‘åº•å±‚æ•°æ®ç»“æ„çš„æŒ‡é’ˆ</strong>ã€‚</li></ul><p>æˆ‘ç”»äº†ä¸€å¼  Redis é”®å€¼å¯¹æ•°æ®åº“çš„å…¨æ™¯å›¾ï¼Œä½ å°±èƒ½æ¸…æ™°çŸ¥é“ Redis å¯¹è±¡å’Œæ•°æ®ç»“æ„çš„å…³ç³»äº†ï¼š</p><figure><img src="https://cdn.nlark.com/yuque/0/2023/png/25684216/1684680946211-1e633f34-29f3-434b-a2e3-6267b88033db.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æ¥ä¸‹é‡Œï¼Œå°±å¥½å¥½èŠä¸€ä¸‹åº•å±‚æ•°æ®ç»“æ„ï¼</p><h1 id="sds" tabindex="-1"><a class="header-anchor" href="#sds" aria-hidden="true">#</a> SDS</h1><p>å­—ç¬¦ä¸²åœ¨ Redis ä¸­æ˜¯å¾ˆå¸¸ç”¨çš„ï¼Œé”®å€¼å¯¹ä¸­çš„é”®æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå€¼æœ‰æ—¶ä¹Ÿæ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚</p><p>Redis æ˜¯ç”¨ C è¯­è¨€å®ç°çš„ï¼Œä½†æ˜¯å®ƒ<strong>æ²¡æœ‰ç›´æ¥ä½¿ç”¨ C è¯­è¨€çš„ char* å­—ç¬¦æ•°ç»„æ¥å®ç°å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯è‡ªå·±å°è£…äº†ä¸€ä¸ªåä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆsimple dynamic stringï¼ŒSDSï¼‰ çš„æ•°æ®ç»“æ„æ¥è¡¨ç¤ºå­—ç¬¦ä¸²</strong>ï¼Œä¹Ÿå°±æ˜¯ Redis çš„ String æ•°æ®ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ SDSã€‚</p><p>æ—¢ç„¶ Redis è®¾è®¡äº† SDS ç»“æ„æ¥è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œè‚¯å®šæ˜¯ C è¯­è¨€çš„ char* å­—ç¬¦æ•°ç»„å­˜åœ¨ä¸€äº›ç¼ºé™·ã€‚</p><p>è¦äº†è§£è¿™ä¸€ç‚¹ï¼Œå¾—å…ˆæ¥çœ‹çœ‹ char* å­—ç¬¦æ•°ç»„çš„ç»“æ„ã€‚</p><h2 id="c-è¯­è¨€å­—ç¬¦ä¸²çš„ç¼ºé™·" tabindex="-1"><a class="header-anchor" href="#c-è¯­è¨€å­—ç¬¦ä¸²çš„ç¼ºé™·" aria-hidden="true">#</a> C è¯­è¨€å­—ç¬¦ä¸²çš„ç¼ºé™·</h2><p>C è¯­è¨€çš„å­—ç¬¦ä¸²å…¶å®å°±æ˜¯ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œå³æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ æ˜¯å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªå­—ç¬¦ã€‚</p><p>æ¯”å¦‚ï¼Œä¸‹å›¾å°±æ˜¯å­—ç¬¦ä¸²â€œxiaolinâ€çš„ char* å­—ç¬¦æ•°ç»„çš„ç»“æ„ï¼š</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020723681.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æ²¡å­¦è¿‡ C è¯­è¨€çš„åŒå­¦ï¼Œå¯èƒ½ä¼šå¥½å¥‡ä¸ºä»€ä¹ˆæœ€åä¸€ä¸ªå­—ç¬¦æ˜¯â€œ\0â€ï¼Ÿ</p><p>åœ¨ C è¯­è¨€é‡Œï¼Œå¯¹å­—ç¬¦ä¸²æ“ä½œæ—¶ï¼Œchar * æŒ‡é’ˆåªæ˜¯æŒ‡å‘å­—ç¬¦æ•°ç»„çš„èµ·å§‹ä½ç½®ï¼Œè€Œ<strong>å­—ç¬¦æ•°ç»„çš„ç»“å°¾ä½ç½®å°±ç”¨â€œ\0â€è¡¨ç¤ºï¼Œæ„æ€æ˜¯æŒ‡å­—ç¬¦ä¸²çš„ç»“æŸ</strong>ã€‚</p><p>å› æ­¤ï¼ŒC è¯­è¨€æ ‡å‡†åº“ä¸­çš„å­—ç¬¦ä¸²æ“ä½œå‡½æ•°å°±é€šè¿‡åˆ¤æ–­å­—ç¬¦æ˜¯ä¸æ˜¯ â€œ\0â€ æ¥å†³å®šè¦ä¸è¦åœæ­¢æ“ä½œï¼Œå¦‚æœå½“å‰å­—ç¬¦ä¸æ˜¯ â€œ\0â€ ï¼Œè¯´æ˜å­—ç¬¦ä¸²è¿˜æ²¡ç»“æŸï¼Œå¯ä»¥ç»§ç»­æ“ä½œï¼Œå¦‚æœå½“å‰å­—ç¬¦æ˜¯ â€œ\0â€ æ˜¯åˆ™è¯´æ˜å­—ç¬¦ä¸²ç»“æŸäº†ï¼Œå°±è¦åœæ­¢æ“ä½œã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼ŒC è¯­è¨€è·å–å­—ç¬¦ä¸²é•¿åº¦çš„å‡½æ•° strlenï¼Œå°±æ˜¯é€šè¿‡å­—ç¬¦æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶è¿›è¡Œè®¡æ•°ï¼Œç­‰é‡åˆ°å­—ç¬¦ä¸º â€œ\0â€ åï¼Œå°±ä¼šåœæ­¢éå†ï¼Œç„¶åè¿”å›å·²ç»ç»Ÿè®¡åˆ°çš„å­—ç¬¦ä¸ªæ•°ï¼Œå³ä¸ºå­—ç¬¦ä¸²é•¿åº¦ã€‚ä¸‹å›¾æ˜¾ç¤ºäº† strlen å‡½æ•°çš„æ‰§è¡Œæµç¨‹ï¼š</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020723844.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¾ˆæ˜æ˜¾ï¼Œ**C è¯­è¨€è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦æ˜¯ Oï¼ˆNï¼‰ï¼ˆ**<em><strong>è¿™æ˜¯ä¸€ä¸ªå¯ä»¥æ”¹è¿›çš„åœ°æ–¹</strong></em>ï¼‰</p><p>C è¯­è¨€å­—ç¬¦ä¸²ç”¨ â€œ\0â€ å­—ç¬¦ä½œä¸ºç»“å°¾æ ‡è®°æœ‰ä¸ªç¼ºé™·ã€‚å‡è®¾æœ‰ä¸ªå­—ç¬¦ä¸²ä¸­æœ‰ä¸ª â€œ\0â€ å­—ç¬¦ï¼Œè¿™æ—¶åœ¨æ“ä½œè¿™ä¸ªå­—ç¬¦ä¸²æ—¶å°±ä¼š<strong>ææ—©ç»“æŸ</strong>ï¼Œæ¯”å¦‚ â€œxiao\0linâ€ å­—ç¬¦ä¸²ï¼Œè®¡ç®—å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶å€™åˆ™ä¼šæ˜¯ 4ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020723480.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å› æ­¤ï¼Œé™¤äº†å­—ç¬¦ä¸²çš„æœ«å°¾ä¹‹å¤–ï¼Œ<strong>å­—ç¬¦ä¸²é‡Œé¢ä¸èƒ½å«æœ‰ â€œ\0â€ å­—ç¬¦</strong>ï¼Œå¦åˆ™æœ€å…ˆè¢«ç¨‹åºè¯»å…¥çš„ â€œ\0â€ å­—ç¬¦å°†è¢«è¯¯è®¤ä¸ºæ˜¯å­—ç¬¦ä¸²ç»“å°¾ï¼Œ**è¿™ä¸ªé™åˆ¶ä½¿å¾— C è¯­è¨€çš„å­—ç¬¦ä¸²åªèƒ½ä¿å­˜æ–‡æœ¬æ•°æ®ï¼Œ**<strong>ä¸èƒ½ä¿å­˜åƒå›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘è¿™æ ·çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆ<em><strong><strong>è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¯ä»¥æ”¹è¿›çš„åœ°æ–¹</strong></strong></em>ï¼‰</strong></p><p>å¦å¤–ï¼Œ C è¯­è¨€æ ‡å‡†åº“ä¸­å­—ç¬¦ä¸²çš„æ“ä½œå‡½æ•°æ˜¯å¾ˆä¸å®‰å…¨çš„ï¼Œå¯¹ç¨‹åºå‘˜å¾ˆä¸å‹å¥½ï¼Œç¨å¾®ä¸€ä¸æ³¨æ„ï¼Œå°±ä¼šå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œstrcat å‡½æ•°æ˜¯å¯ä»¥å°†ä¸¤ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥åœ¨ä¸€èµ·ã€‚</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">//å°† src å­—ç¬¦ä¸²æ‹¼æ¥åˆ° dest å­—ç¬¦ä¸²åé¢</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>dest<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>C è¯­è¨€çš„å­—ç¬¦ä¸²æ˜¯ä¸ä¼šè®°å½•è‡ªèº«çš„ç¼“å†²åŒºå¤§å°çš„</strong>ï¼Œæ‰€ä»¥ strcat å‡½æ•°å‡å®šç¨‹åºå‘˜åœ¨æ‰§è¡Œè¿™ä¸ªå‡½æ•°æ—¶ï¼Œå·²ç»ä¸º dest åˆ†é…äº†è¶³å¤Ÿå¤šçš„å†…å­˜ï¼Œå¯ä»¥å®¹çº³ src å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œè€Œ**ä¸€æ—¦è¿™ä¸ªå‡å®šä¸æˆç«‹ï¼Œå°±ä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡ºå°†å¯èƒ½ä¼šé€ æˆç¨‹åºè¿è¡Œç»ˆæ­¢ï¼ˆ**<em><strong>è¿™æ˜¯ä¸€ä¸ªå¯ä»¥æ”¹è¿›çš„åœ°æ–¹</strong></em>ï¼‰ã€‚</p><p>è€Œä¸”ï¼Œstrcat å‡½æ•°å’Œ strlen å‡½æ•°ç±»ä¼¼ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿå¾ˆé«˜ï¼Œä¹Ÿéƒ½éœ€è¦å…ˆé€šè¿‡éå†å­—ç¬¦ä¸²æ‰èƒ½å¾—åˆ°ç›®æ ‡å­—ç¬¦ä¸²çš„æœ«å°¾ã€‚ç„¶åå¯¹äº strcat å‡½æ•°æ¥è¯´ï¼Œè¿˜è¦å†éå†æºå­—ç¬¦ä¸²æ‰èƒ½å®Œæˆè¿½åŠ ï¼Œ<strong>å¯¹å­—ç¬¦ä¸²çš„æ“ä½œæ•ˆç‡ä¸é«˜</strong>ã€‚</p><p>æ€»ç»“ <strong>C è¯­è¨€çš„å­—ç¬¦ä¸²ä¸è¶³ä¹‹å¤„ä»¥åŠå¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼š</strong></p><ul><li><strong>è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦ä¸º Oï¼ˆNï¼‰ï¼›</strong></li><li><strong>å­—ç¬¦ä¸²çš„ç»“å°¾æ˜¯ä»¥ â€œ\0â€ å­—ç¬¦æ ‡è¯†ï¼Œå­—ç¬¦ä¸²é‡Œé¢ä¸èƒ½åŒ…å«æœ‰ â€œ\0â€ å­—ç¬¦ï¼Œå› æ­¤ä¸èƒ½ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ï¼›</strong></li><li><strong>å­—ç¬¦ä¸²æ“ä½œå‡½æ•°ä¸é«˜æ•ˆä¸”ä¸å®‰å…¨ï¼Œæ¯”å¦‚æœ‰ç¼“å†²åŒºæº¢å‡ºçš„é£é™©ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆç¨‹åºè¿è¡Œç»ˆæ­¢ï¼›</strong></li></ul><p>Redis å®ç°çš„ SDS çš„ç»“æ„å°±æŠŠä¸Šé¢è¿™äº›é—®é¢˜è§£å†³äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ Redis æ˜¯å¦‚ä½•è§£å†³çš„ã€‚</p><h2 id="sds-ç»“æ„è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#sds-ç»“æ„è®¾è®¡" aria-hidden="true">#</a> SDS ç»“æ„è®¾è®¡</h2><p>ä¸‹å›¾å°±æ˜¯ Redis 5.0 çš„ SDS çš„æ•°æ®ç»“æ„ï¼š</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020723005.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ç»“æ„ä¸­çš„æ¯ä¸ªæˆå‘˜å˜é‡åˆ†åˆ«ä»‹ç»ä¸‹ï¼š</p><ul><li><strong>lenï¼Œè®°å½•äº†å­—ç¬¦ä¸²é•¿åº¦</strong>ã€‚è¿™æ ·è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶å€™ï¼Œåªéœ€è¦è¿”å›è¿™ä¸ªæˆå‘˜å˜é‡å€¼å°±è¡Œï¼Œæ—¶é—´å¤æ‚åº¦åªéœ€è¦ Oï¼ˆ1ï¼‰ã€‚</li><li><strong>allocï¼Œåˆ†é…ç»™å­—ç¬¦æ•°ç»„çš„ç©ºé—´é•¿åº¦</strong>ã€‚è¿™æ ·åœ¨ä¿®æ”¹å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ alloc - len è®¡ç®—å‡ºå‰©ä½™çš„ç©ºé—´å¤§å°ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­ç©ºé—´æ˜¯å¦æ»¡è¶³ä¿®æ”¹éœ€æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³çš„è¯ï¼Œå°±ä¼šè‡ªåŠ¨å°† SDS çš„ç©ºé—´æ‰©å±•è‡³æ‰§è¡Œä¿®æ”¹æ‰€éœ€çš„å¤§å°ï¼Œç„¶åæ‰æ‰§è¡Œå®é™…çš„ä¿®æ”¹æ“ä½œï¼Œæ‰€ä»¥ä½¿ç”¨ SDS æ—¢ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ SDS çš„ç©ºé—´å¤§å°ï¼Œä¹Ÿä¸ä¼šå‡ºç°å‰é¢æ‰€è¯´çš„ç¼“å†²åŒºæº¢å‡ºçš„é—®é¢˜ã€‚</li><li><strong>flagsï¼Œç”¨æ¥è¡¨ç¤ºä¸åŒç±»å‹çš„ SDS</strong>ã€‚ä¸€å…±è®¾è®¡äº† 5 ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ sdshdr5ã€sdshdr8ã€sdshdr16ã€sdshdr32 å’Œ sdshdr64ã€‚</li><li><strong>buf[]ï¼Œå­—ç¬¦æ•°ç»„ï¼Œç”¨æ¥ä¿å­˜å®é™…æ•°æ®</strong>ã€‚ä¸ä»…å¯ä»¥ä¿å­˜å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼ŒRedis çš„ SDS ç»“æ„åœ¨åŸæœ¬å­—ç¬¦æ•°ç»„ä¹‹ä¸Šï¼Œå¢åŠ äº†ä¸‰ä¸ªå…ƒæ•°æ®ï¼šlenã€allocã€flagsï¼Œç”¨æ¥è§£å†³ C è¯­è¨€å­—ç¬¦ä¸²çš„ç¼ºé™·ã€‚</p><h3 id="o-1-å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦" tabindex="-1"><a class="header-anchor" href="#o-1-å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦" aria-hidden="true">#</a> Oï¼ˆ1ï¼‰å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦</h3><p>C è¯­è¨€çš„å­—ç¬¦ä¸²é•¿åº¦è·å– strlen å‡½æ•°ï¼Œéœ€è¦é€šè¿‡éå†çš„æ–¹å¼æ¥ç»Ÿè®¡å­—ç¬¦ä¸²é•¿åº¦ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ Oï¼ˆNï¼‰ã€‚</p><p>è€Œ Redis çš„ SDS ç»“æ„å› ä¸ºåŠ å…¥äº† len æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆ<strong>è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶å€™ï¼Œç›´æ¥è¿”å›è¿™ä¸ªæˆå‘˜å˜é‡çš„å€¼å°±è¡Œï¼Œæ‰€ä»¥å¤æ‚åº¦åªæœ‰ Oï¼ˆ1ï¼‰</strong>ã€‚</p><h3 id="äºŒè¿›åˆ¶å®‰å…¨" tabindex="-1"><a class="header-anchor" href="#äºŒè¿›åˆ¶å®‰å…¨" aria-hidden="true">#</a> äºŒè¿›åˆ¶å®‰å…¨</h3><p>å› ä¸º SDS ä¸éœ€è¦ç”¨ â€œ\0â€ å­—ç¬¦æ¥æ ‡è¯†å­—ç¬¦ä¸²ç»“å°¾äº†ï¼Œè€Œæ˜¯<strong>æœ‰ä¸ªä¸“é—¨çš„ len æˆå‘˜å˜é‡æ¥è®°å½•é•¿åº¦ï¼Œæ‰€ä»¥å¯å­˜å‚¨åŒ…å« â€œ\0â€ çš„æ•°æ®</strong>ã€‚ä½†æ˜¯ SDS ä¸ºäº†å…¼å®¹éƒ¨åˆ† C è¯­è¨€æ ‡å‡†åº“çš„å‡½æ•°ï¼Œ SDS å­—ç¬¦ä¸²ç»“å°¾è¿˜æ˜¯ä¼šåŠ ä¸Š â€œ\0â€ å­—ç¬¦ã€‚</p><p>å› æ­¤ï¼Œ SDS çš„ API éƒ½æ˜¯ä»¥å¤„ç†äºŒè¿›åˆ¶çš„æ–¹å¼æ¥å¤„ç† SDS å­˜æ”¾åœ¨ buf[] é‡Œçš„æ•°æ®ï¼Œç¨‹åºä¸ä¼šå¯¹å…¶ä¸­çš„æ•°æ®åšä»»ä½•é™åˆ¶ï¼Œæ•°æ®å†™å…¥çš„æ—¶å€™æ—¶ä»€ä¹ˆæ ·çš„ï¼Œå®ƒè¢«è¯»å–æ—¶å°±æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p><p><strong>é€šè¿‡ä½¿ç”¨äºŒè¿›åˆ¶å®‰å…¨çš„ SDSï¼Œè€Œä¸æ˜¯ C å­—ç¬¦ä¸²ï¼Œä½¿å¾— Redis ä¸ä»…å¯ä»¥ä¿å­˜æ–‡æœ¬æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä¿å­˜ä»»æ„æ ¼å¼çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</strong></p><h3 id="ä¸ä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡º" tabindex="-1"><a class="header-anchor" href="#ä¸ä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡º" aria-hidden="true">#</a> ä¸ä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡º</h3><p>C è¯­è¨€çš„å­—ç¬¦ä¸²æ ‡å‡†åº“æä¾›çš„å­—ç¬¦ä¸²æ“ä½œå‡½æ•°ï¼Œå¤§å¤šæ•°ï¼ˆæ¯”å¦‚ strcat è¿½åŠ å­—ç¬¦ä¸²å‡½æ•°ï¼‰éƒ½æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºè¿™äº›å‡½æ•°æŠŠç¼“å†²åŒºå¤§å°æ˜¯å¦æ»¡è¶³æ“ä½œéœ€æ±‚çš„å·¥ä½œäº¤ç”±å¼€å‘è€…æ¥ä¿è¯ï¼Œç¨‹åºå†…éƒ¨å¹¶ä¸ä¼šåˆ¤æ–­ç¼“å†²åŒºå¤§å°æ˜¯å¦è¶³å¤Ÿç”¨ï¼Œå½“å‘ç”Ÿäº†ç¼“å†²åŒºæº¢å‡ºå°±æœ‰å¯èƒ½é€ æˆç¨‹åºå¼‚å¸¸ç»“æŸã€‚</p><p>æ‰€ä»¥ï¼ŒRedis çš„ SDS ç»“æ„é‡Œå¼•å…¥äº† alloc å’Œ len æˆå‘˜å˜é‡ï¼Œè¿™æ · SDS API é€šè¿‡ alloc - len è®¡ç®—ï¼Œå¯ä»¥ç®—å‡ºå‰©ä½™å¯ç”¨çš„ç©ºé—´å¤§å°ï¼Œè¿™æ ·åœ¨å¯¹å­—ç¬¦ä¸²åšä¿®æ”¹æ“ä½œçš„æ—¶å€™ï¼Œå°±å¯ä»¥ç”±ç¨‹åºå†…éƒ¨åˆ¤æ–­ç¼“å†²åŒºå¤§å°æ˜¯å¦è¶³å¤Ÿç”¨ã€‚</p><p>è€Œä¸”ï¼Œ<strong>å½“åˆ¤æ–­å‡ºç¼“å†²åŒºå¤§å°ä¸å¤Ÿç”¨æ—¶ï¼ŒRedis ä¼šè‡ªåŠ¨æ‰©å¤§ SDS çš„ç©ºé—´å¤§å°</strong>ï¼Œä»¥æ»¡è¶³ä¿®æ”¹æ‰€éœ€çš„å¤§å°ã€‚</p><p>SDS æ‰©å®¹çš„è§„åˆ™ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>hisds <span class="token function">hi_sdsMakeRoomFor</span><span class="token punctuation">(</span>hisds s<span class="token punctuation">,</span> <span class="token class-name">size_t</span> addlen<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment">// sç›®å‰çš„å‰©ä½™ç©ºé—´å·²è¶³å¤Ÿï¼Œæ— éœ€æ‰©å±•ï¼Œç›´æ¥è¿”å›</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>avail <span class="token operator">&gt;=</span> addlen<span class="token punctuation">)</span>
        <span class="token keyword">return</span> s<span class="token punctuation">;</span>
    <span class="token comment">//è·å–ç›®å‰sçš„é•¿åº¦</span>
    len <span class="token operator">=</span> <span class="token function">hi_sdslen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sh <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>s <span class="token operator">-</span> <span class="token function">hi_sdsHdrSize</span><span class="token punctuation">(</span>oldtype<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ‰©å±•ä¹‹å s è‡³å°‘éœ€è¦çš„é•¿åº¦</span>
    newlen <span class="token operator">=</span> <span class="token punctuation">(</span>len <span class="token operator">+</span> addlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ ¹æ®æ–°é•¿åº¦ï¼Œä¸ºsåˆ†é…æ–°ç©ºé—´æ‰€éœ€è¦çš„å¤§å°</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newlen <span class="token operator">&lt;</span> HI_SDS_MAX_PREALLOC<span class="token punctuation">)</span>
        <span class="token comment">//æ–°é•¿åº¦&lt;HI_SDS_MAX_PREALLOC åˆ™åˆ†é…æ‰€éœ€ç©ºé—´*2çš„ç©ºé—´</span>
        newlen <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token comment">//å¦åˆ™ï¼Œåˆ†é…é•¿åº¦ä¸ºç›®å‰é•¿åº¦+1MB</span>
        newlen <span class="token operator">+=</span> HI_SDS_MAX_PREALLOC<span class="token punctuation">;</span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¦‚æœæ‰€éœ€çš„ sds é•¿åº¦<strong>å°äº 1 MB</strong>ï¼Œé‚£ä¹ˆæœ€åçš„æ‰©å®¹æ˜¯æŒ‰ç…§<strong>ç¿»å€æ‰©å®¹</strong>æ¥æ‰§è¡Œçš„ï¼Œå³ 2 å€çš„newlen</li><li>å¦‚æœæ‰€éœ€çš„ sds é•¿åº¦<strong>è¶…è¿‡ 1 MB</strong>ï¼Œé‚£ä¹ˆæœ€åçš„æ‰©å®¹é•¿åº¦åº”è¯¥æ˜¯ newlen <strong>+ 1MB</strong>ã€‚</li></ul><p>åœ¨æ‰©å®¹ SDS ç©ºé—´ä¹‹å‰ï¼ŒSDS API ä¼šä¼˜å…ˆæ£€æŸ¥æœªä½¿ç”¨ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œå¦‚æœä¸å¤Ÿçš„è¯ï¼ŒAPI ä¸ä»…ä¼šä¸º SDS åˆ†é…ä¿®æ”¹æ‰€å¿…é¡»è¦çš„ç©ºé—´ï¼Œè¿˜ä¼šç»™ SDS åˆ†é…é¢å¤–çš„ã€Œæœªä½¿ç”¨ç©ºé—´ã€ã€‚</p><p>è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œä¸‹æ¬¡åœ¨æ“ä½œ SDS æ—¶ï¼Œå¦‚æœ SDS ç©ºé—´å¤Ÿçš„è¯ï¼ŒAPI å°±ä¼šç›´æ¥ä½¿ç”¨ã€Œæœªä½¿ç”¨ç©ºé—´ã€ï¼Œè€Œæ— é¡»æ‰§è¡Œå†…å­˜åˆ†é…ï¼Œ<strong>æœ‰æ•ˆçš„å‡å°‘å†…å­˜åˆ†é…æ¬¡æ•°</strong>ã€‚</p><p>æ‰€ä»¥ï¼Œä½¿ç”¨ SDS å³ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ SDS çš„ç©ºé—´å¤§å°ï¼Œä¹Ÿä¸ä¼šå‡ºç°ç¼“å†²åŒºæº¢å‡ºçš„é—®é¢˜ã€‚</p><h3 id="èŠ‚çœå†…å­˜ç©ºé—´" tabindex="-1"><a class="header-anchor" href="#èŠ‚çœå†…å­˜ç©ºé—´" aria-hidden="true">#</a> èŠ‚çœå†…å­˜ç©ºé—´</h3><p>SDS ç»“æ„ä¸­æœ‰ä¸ª flags æˆå‘˜å˜é‡ï¼Œè¡¨ç¤ºçš„æ˜¯ SDS ç±»å‹ã€‚</p><p>Redis ä¸€å…±è®¾è®¡äº† 5 ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ sdshdr5ã€sdshdr8ã€sdshdr16ã€sdshdr32 å’Œ sdshdr64ã€‚</p><p>è¿™ 5 ç§ç±»å‹çš„ä¸»è¦<strong>åŒºåˆ«å°±åœ¨äºï¼Œå®ƒä»¬æ•°æ®ç»“æ„ä¸­çš„ len å’Œ alloc æˆå‘˜å˜é‡çš„æ•°æ®ç±»å‹ä¸åŒ</strong>ã€‚</p><p>æ¯”å¦‚ sdshdr16 å’Œ sdshdr32 è¿™ä¸¤ä¸ªç±»å‹ï¼Œå®ƒä»¬çš„å®šä¹‰åˆ†åˆ«å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__packed__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token class-name">sdshdr16</span> <span class="token punctuation">{</span>
    <span class="token class-name">uint16_t</span> len<span class="token punctuation">;</span>
    <span class="token class-name">uint16_t</span> alloc<span class="token punctuation">;</span> 
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> flags<span class="token punctuation">;</span> 
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">struct</span> <span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__packed__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token class-name">sdshdr32</span> <span class="token punctuation">{</span>
    <span class="token class-name">uint32_t</span> len<span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> alloc<span class="token punctuation">;</span> 
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> flags<span class="token punctuation">;</span>
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li>sdshdr16 ç±»å‹çš„ len å’Œ alloc çš„æ•°æ®ç±»å‹éƒ½æ˜¯ uint16_tï¼Œè¡¨ç¤ºå­—ç¬¦æ•°ç»„é•¿åº¦å’Œåˆ†é…ç©ºé—´å¤§å°ä¸èƒ½è¶…è¿‡ 2 çš„ 16 æ¬¡æ–¹ã€‚</li><li>sdshdr32 åˆ™éƒ½æ˜¯ uint32_tï¼Œè¡¨ç¤ºè¡¨ç¤ºå­—ç¬¦æ•°ç»„é•¿åº¦å’Œåˆ†é…ç©ºé—´å¤§å°ä¸èƒ½è¶…è¿‡ 2 çš„ 32 æ¬¡æ–¹ã€‚</li></ul><p><strong>ä¹‹æ‰€ä»¥ SDS è®¾è®¡ä¸åŒç±»å‹çš„ç»“æ„ä½“ï¼Œæ˜¯ä¸ºäº†èƒ½çµæ´»ä¿å­˜ä¸åŒå¤§å°çš„å­—ç¬¦ä¸²ï¼Œä»è€Œæœ‰æ•ˆèŠ‚çœå†…å­˜ç©ºé—´</strong>ã€‚æ¯”å¦‚ï¼Œåœ¨ä¿å­˜å°å­—ç¬¦ä¸²æ—¶ï¼Œç»“æ„å¤´å ç”¨ç©ºé—´ä¹Ÿæ¯”è¾ƒå°‘ã€‚</p><p>é™¤äº†è®¾è®¡ä¸åŒç±»å‹çš„ç»“æ„ä½“ï¼ŒRedis åœ¨ç¼–ç¨‹ä¸Šè¿˜<strong>ä½¿ç”¨äº†ä¸“é—¨çš„ç¼–è¯‘ä¼˜åŒ–æ¥èŠ‚çœå†…å­˜ç©ºé—´</strong>ï¼Œå³åœ¨ struct å£°æ˜äº† <strong>attribute</strong> ((packed)) ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼š<strong>å‘Šè¯‰ç¼–è¯‘å™¨å–æ¶ˆç»“æ„ä½“åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä¼˜åŒ–å¯¹é½ï¼ŒæŒ‰ç…§å®é™…å ç”¨å­—èŠ‚æ•°è¿›è¡Œå¯¹é½</strong>ã€‚</p><p>æ¯”å¦‚ï¼Œsdshdr16 ç±»å‹çš„ SDSï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šæŒ‰ç…§ 2 å­—èŠ‚å¯¹é½çš„æ–¹å¼ç»™å˜é‡åˆ†é…å†…å­˜ï¼Œè¿™æ„å‘³ç€ï¼Œå³ä½¿ä¸€ä¸ªå˜é‡çš„å¤§å°ä¸åˆ° 2 ä¸ªå­—èŠ‚ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šç»™å®ƒåˆ†é… 2 ä¸ªå­—èŠ‚ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä¸‹é¢è¿™ä¸ªç»“æ„ä½“ï¼Œå®ƒæœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡ï¼Œç±»å‹åˆ†åˆ«æ˜¯ char å’Œ intï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">struct</span> <span class="token class-name">test1</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> a<span class="token punctuation">;</span>
    <span class="token keyword">int</span> b<span class="token punctuation">;</span>
 <span class="token punctuation">}</span> test1<span class="token punctuation">;</span>
 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%lu\n&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>test1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¤§å®¶çŒœçŒœè¿™ä¸ªç»“æ„ä½“å¤§å°æ˜¯å¤šå°‘ï¼Ÿæˆ‘å…ˆç›´æ¥è¯´ç­”æ¡ˆï¼Œè¿™ä¸ªç»“æ„ä½“å¤§å°è®¡ç®—å‡ºæ¥æ˜¯ 8ã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020723464.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>è¿™æ˜¯å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨æ˜¯ä½¿ç”¨ã€Œå­—èŠ‚å¯¹é½ã€çš„æ–¹å¼åˆ†é…å†…å­˜ï¼Œè™½ç„¶ char ç±»å‹åªå ä¸€ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯ç”±äºæˆå‘˜å˜é‡é‡Œæœ‰ int ç±»å‹ï¼Œå®ƒå ç”¨äº† 4 ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥åœ¨æˆå‘˜å˜é‡ä¸º char ç±»å‹åˆ†é…å†…å­˜æ—¶ï¼Œä¼šåˆ†é… 4 ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­è¿™å¤šä½™çš„ 3 ä¸ªå­—èŠ‚æ˜¯ä¸ºäº†å­—èŠ‚å¯¹é½è€Œåˆ†é…çš„ï¼Œç›¸å½“äºæœ‰ 3 ä¸ªå­—èŠ‚è¢«æµªè´¹æ‰äº†ã€‚</p><p>å¦‚æœä¸æƒ³ç¼–è¯‘å™¨ä½¿ç”¨å­—èŠ‚å¯¹é½çš„æ–¹å¼è¿›è¡Œåˆ†é…å†…å­˜ï¼Œå¯ä»¥é‡‡ç”¨äº† <strong>attribute</strong> ((packed)) å±æ€§å®šä¹‰ç»“æ„ä½“ï¼Œè¿™æ ·ä¸€æ¥ï¼Œç»“æ„ä½“å®é™…å ç”¨å¤šå°‘å†…å­˜ç©ºé—´ï¼Œç¼–è¯‘å™¨å°±åˆ†é…å¤šå°‘ç©ºé—´ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ç”¨ <strong>attribute</strong> ((packed)) å±æ€§å®šä¹‰ä¸‹é¢çš„ç»“æ„ä½“ ï¼ŒåŒæ ·åŒ…å« char å’Œ int ä¸¤ä¸ªç±»å‹çš„æˆå‘˜å˜é‡ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">struct</span> <span class="token keyword">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>packed<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token class-name">test2</span>  <span class="token punctuation">{</span>
    <span class="token keyword">char</span> a<span class="token punctuation">;</span>
    <span class="token keyword">int</span> b<span class="token punctuation">;</span>
 <span class="token punctuation">}</span> test2<span class="token punctuation">;</span>
 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%lu\n&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>test2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ—¶æ‰“å°çš„ç»“æœæ˜¯ 5ï¼ˆ1 ä¸ªå­—èŠ‚ char + 4 å­—èŠ‚ intï¼‰ã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020723522.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¯ä»¥çœ‹å¾—å‡ºï¼Œè¿™æ˜¯æŒ‰ç…§å®é™…å ç”¨å­—èŠ‚æ•°è¿›è¡Œåˆ†é…å†…å­˜çš„ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ã€‚</p><hr><h1 id="é“¾è¡¨" tabindex="-1"><a class="header-anchor" href="#é“¾è¡¨" aria-hidden="true">#</a> é“¾è¡¨</h1><p>Redis çš„ List å¯¹è±¡çš„åº•å±‚å®ç°ä¹‹ä¸€å°±æ˜¯é“¾è¡¨ã€‚C è¯­è¨€æœ¬èº«æ²¡æœ‰é“¾è¡¨è¿™ä¸ªæ•°æ®ç»“æ„ï¼Œæ‰€ä»¥ Redis è‡ªå·±è®¾è®¡äº†ä¸€ä¸ªé“¾è¡¨æ•°æ®ç»“æ„ã€‚</p><h2 id="é“¾è¡¨èŠ‚ç‚¹ç»“æ„è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#é“¾è¡¨èŠ‚ç‚¹ç»“æ„è®¾è®¡" aria-hidden="true">#</a> é“¾è¡¨èŠ‚ç‚¹ç»“æ„è®¾è®¡</h2><p>å…ˆæ¥çœ‹çœ‹ã€Œé“¾è¡¨èŠ‚ç‚¹ã€ç»“æ„çš„æ ·å­ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">listNode</span> <span class="token punctuation">{</span>
    <span class="token comment">//å‰ç½®èŠ‚ç‚¹</span>
    <span class="token keyword">struct</span> <span class="token class-name">listNode</span> <span class="token operator">*</span>prev<span class="token punctuation">;</span>
    <span class="token comment">//åç½®èŠ‚ç‚¹</span>
    <span class="token keyword">struct</span> <span class="token class-name">listNode</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>
    <span class="token comment">//èŠ‚ç‚¹çš„å€¼</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span> listNode<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ‰å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹ï¼Œå¯ä»¥çœ‹çš„å‡ºï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚</p><figure><img src="https://cdn.nlark.com/yuque/0/2023/png/25684216/1684680948401-88c7d44c-a299-4cc9-8689-eb65317cedc6.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="é“¾è¡¨ç»“æ„è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#é“¾è¡¨ç»“æ„è®¾è®¡" aria-hidden="true">#</a> é“¾è¡¨ç»“æ„è®¾è®¡</h2><p>ä¸è¿‡ï¼ŒRedis åœ¨ listNode ç»“æ„ä½“åŸºç¡€ä¸Šåˆå°è£…äº† list è¿™ä¸ªæ•°æ®ç»“æ„ï¼Œè¿™æ ·æ“ä½œèµ·æ¥ä¼šæ›´æ–¹ä¾¿ï¼Œé“¾è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">list</span> <span class="token punctuation">{</span>
    <span class="token comment">//é“¾è¡¨å¤´èŠ‚ç‚¹</span>
    listNode <span class="token operator">*</span>head<span class="token punctuation">;</span>
    <span class="token comment">//é“¾è¡¨å°¾èŠ‚ç‚¹</span>
    listNode <span class="token operator">*</span>tail<span class="token punctuation">;</span>
    <span class="token comment">//èŠ‚ç‚¹å€¼å¤åˆ¶å‡½æ•°</span>
    <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>dup<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//èŠ‚ç‚¹å€¼é‡Šæ”¾å‡½æ•°</span>
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>free<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//èŠ‚ç‚¹å€¼æ¯”è¾ƒå‡½æ•°</span>
    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>match<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//é“¾è¡¨èŠ‚ç‚¹æ•°é‡</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> len<span class="token punctuation">;</span>
<span class="token punctuation">}</span> list<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>list ç»“æ„ä¸ºé“¾è¡¨æä¾›äº†é“¾è¡¨å¤´æŒ‡é’ˆ headã€é“¾è¡¨å°¾èŠ‚ç‚¹ tailã€é“¾è¡¨èŠ‚ç‚¹æ•°é‡ lenã€ä»¥åŠå¯ä»¥è‡ªå®šä¹‰å®ç°çš„ dupã€freeã€match å‡½æ•°ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢æ˜¯ç”± list ç»“æ„å’Œ 3 ä¸ª listNode ç»“æ„ç»„æˆçš„é“¾è¡¨ã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020723017.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="é“¾è¡¨çš„ä¼˜åŠ¿ä¸ç¼ºé™·" tabindex="-1"><a class="header-anchor" href="#é“¾è¡¨çš„ä¼˜åŠ¿ä¸ç¼ºé™·" aria-hidden="true">#</a> é“¾è¡¨çš„ä¼˜åŠ¿ä¸ç¼ºé™·</h2><p>Redis çš„é“¾è¡¨å®ç°ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>listNode é“¾è¡¨èŠ‚ç‚¹çš„ç»“æ„é‡Œå¸¦æœ‰ prev å’Œ next æŒ‡é’ˆï¼Œ<strong>è·å–æŸä¸ªèŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹æˆ–åç½®èŠ‚ç‚¹çš„æ—¶é—´å¤æ‚åº¦åªéœ€O(1)ï¼Œè€Œä¸”è¿™ä¸¤ä¸ªæŒ‡é’ˆéƒ½å¯ä»¥æŒ‡å‘ NULLï¼Œæ‰€ä»¥é“¾è¡¨æ˜¯æ— ç¯é“¾è¡¨</strong>ï¼›</li><li>list ç»“æ„å› ä¸ºæä¾›äº†è¡¨å¤´æŒ‡é’ˆ head å’Œè¡¨å°¾èŠ‚ç‚¹ tailï¼Œæ‰€ä»¥<strong>è·å–é“¾è¡¨çš„è¡¨å¤´èŠ‚ç‚¹å’Œè¡¨å°¾èŠ‚ç‚¹çš„æ—¶é—´å¤æ‚åº¦åªéœ€O(1)</strong>ï¼›</li><li>list ç»“æ„å› ä¸ºæä¾›äº†é“¾è¡¨èŠ‚ç‚¹æ•°é‡ lenï¼Œæ‰€ä»¥<strong>è·å–é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°é‡çš„æ—¶é—´å¤æ‚åº¦åªéœ€O(1)</strong>ï¼›</li><li>listNode é“¾è¡¨èŠ‚ä½¿ç”¨ void* æŒ‡é’ˆä¿å­˜èŠ‚ç‚¹å€¼ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ list ç»“æ„çš„ dupã€freeã€match å‡½æ•°æŒ‡é’ˆä¸ºèŠ‚ç‚¹è®¾ç½®è¯¥èŠ‚ç‚¹ç±»å‹ç‰¹å®šçš„å‡½æ•°ï¼Œå› æ­¤<strong>é“¾è¡¨èŠ‚ç‚¹å¯ä»¥ä¿å­˜å„ç§ä¸åŒç±»å‹çš„å€¼</strong>ï¼›</li></ul><p>é“¾è¡¨çš„ç¼ºé™·ä¹Ÿæ˜¯æœ‰çš„ï¼š</p><ul><li>é“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„å†…å­˜éƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œæ„å‘³ç€<strong>æ— æ³•å¾ˆå¥½åˆ©ç”¨ CPU ç¼“å­˜</strong>ã€‚èƒ½å¾ˆå¥½åˆ©ç”¨ CPU ç¼“å­˜çš„æ•°æ®ç»“æ„å°±æ˜¯æ•°ç»„ï¼Œå› ä¸ºæ•°ç»„çš„å†…å­˜æ˜¯è¿ç»­çš„ï¼Œè¿™æ ·å°±å¯ä»¥å……åˆ†åˆ©ç”¨ CPU ç¼“å­˜æ¥åŠ é€Ÿè®¿é—®ã€‚</li><li>ä¿å­˜ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹çš„å€¼éƒ½éœ€è¦ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ç»“æ„å¤´çš„åˆ†é…ï¼Œ<strong>å†…å­˜å¼€é”€è¾ƒå¤§</strong>ã€‚</li></ul><p>å› æ­¤ï¼ŒRedis 3.0 çš„ List å¯¹è±¡åœ¨æ•°æ®é‡æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œä¼šé‡‡ç”¨ã€Œå‹ç¼©åˆ—è¡¨ã€ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„çš„å®ç°ï¼Œå®ƒçš„ä¼˜åŠ¿æ˜¯èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå¹¶ä¸”æ˜¯å†…å­˜ç´§å‡‘å‹çš„æ•°æ®ç»“æ„ã€‚</p><p>ä¸è¿‡ï¼Œå‹ç¼©åˆ—è¡¨å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œæ‰€ä»¥ Redis åœ¨ 3.2 ç‰ˆæœ¬è®¾è®¡äº†æ–°çš„æ•°æ®ç»“æ„ quicklistï¼Œå¹¶å°† List å¯¹è±¡çš„åº•å±‚æ•°æ®ç»“æ„æ”¹ç”± quicklist å®ç°ã€‚</p><p>ç„¶ååœ¨ Redis 5.0 è®¾è®¡äº†æ–°çš„æ•°æ®ç»“æ„ listpackï¼Œæ²¿ç”¨äº†å‹ç¼©åˆ—è¡¨ç´§å‡‘å‹çš„å†…å­˜å¸ƒå±€ï¼Œæœ€ç»ˆåœ¨æœ€æ–°çš„ Redis ç‰ˆæœ¬ï¼Œå°† Hash å¯¹è±¡å’Œ Zset å¯¹è±¡çš„åº•å±‚æ•°æ®ç»“æ„å®ç°ä¹‹ä¸€çš„å‹ç¼©åˆ—è¡¨ï¼Œæ›¿æ¢æˆç”± listpack å®ç°ã€‚</p><hr><h1 id="å‹ç¼©åˆ—è¡¨" tabindex="-1"><a class="header-anchor" href="#å‹ç¼©åˆ—è¡¨" aria-hidden="true">#</a> å‹ç¼©åˆ—è¡¨</h1><p>å‹ç¼©åˆ—è¡¨çš„æœ€å¤§ç‰¹ç‚¹ï¼Œå°±æ˜¯å®ƒ<strong>è¢«è®¾è®¡æˆä¸€ç§å†…å­˜ç´§å‡‘å‹çš„æ•°æ®ç»“æ„ï¼Œå ç”¨ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œä¸ä»…å¯ä»¥åˆ©ç”¨ CPU ç¼“å­˜ï¼Œè€Œä¸”ä¼šé’ˆå¯¹ä¸åŒé•¿åº¦çš„æ•°æ®ï¼Œè¿›è¡Œç›¸åº”ç¼–ç ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥æœ‰æ•ˆåœ°èŠ‚çœå†…å­˜å¼€é”€ã€‚</strong></p><p>ä½†æ˜¯ï¼Œå‹ç¼©åˆ—è¡¨çš„ç¼ºé™·ä¹Ÿæ˜¯æœ‰çš„ï¼š</p><ul><li>ä¸èƒ½ä¿å­˜è¿‡å¤šçš„å…ƒç´ ï¼Œå¦åˆ™æŸ¥è¯¢æ•ˆç‡å°±ä¼šé™ä½ï¼›</li><li>æ–°å¢æˆ–ä¿®æ”¹æŸä¸ªå…ƒç´ æ—¶ï¼Œå‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜ç©ºé—´éœ€è¦é‡æ–°åˆ†é…ï¼Œç”šè‡³å¯èƒ½å¼•å‘è¿é”æ›´æ–°çš„é—®é¢˜ã€‚</li></ul><p>å› æ­¤ï¼ŒRedis å¯¹è±¡ï¼ˆList å¯¹è±¡ã€Hash å¯¹è±¡ã€Zset å¯¹è±¡ï¼‰åŒ…å«çš„å…ƒç´ æ•°é‡è¾ƒå°‘ï¼Œæˆ–è€…å…ƒç´ å€¼ä¸å¤§çš„æƒ…å†µæ‰ä¼šä½¿ç”¨å‹ç¼©åˆ—è¡¨ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„ã€‚</p><h2 id="å‹ç¼©åˆ—è¡¨ç»“æ„è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#å‹ç¼©åˆ—è¡¨ç»“æ„è®¾è®¡" aria-hidden="true">#</a> å‹ç¼©åˆ—è¡¨ç»“æ„è®¾è®¡</h2><p>å‹ç¼©åˆ—è¡¨æ˜¯ Redis ä¸ºäº†èŠ‚çº¦å†…å­˜è€Œå¼€å‘çš„ï¼Œå®ƒæ˜¯<strong>ç”±è¿ç»­å†…å­˜å—ç»„æˆçš„é¡ºåºå‹æ•°æ®ç»“æ„</strong>ï¼Œæœ‰ç‚¹ç±»ä¼¼äºæ•°ç»„ã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020723898.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å‹ç¼©åˆ—è¡¨åœ¨è¡¨å¤´æœ‰ä¸‰ä¸ªå­—æ®µï¼š</p><ul><li>*<strong>zlbytes*</strong>ï¼Œè®°å½•æ•´ä¸ªå‹ç¼©åˆ—è¡¨å ç”¨å¯¹å†…å­˜å­—èŠ‚æ•°ï¼›</li><li>*<strong>zltail*</strong>ï¼Œè®°å½•å‹ç¼©åˆ—è¡¨ã€Œå°¾éƒ¨ã€èŠ‚ç‚¹è·ç¦»èµ·å§‹åœ°å€ç”±å¤šå°‘å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯åˆ—è¡¨å°¾çš„åç§»é‡ï¼›</li><li>*<strong>zllen*</strong>ï¼Œè®°å½•å‹ç¼©åˆ—è¡¨åŒ…å«çš„èŠ‚ç‚¹æ•°é‡ï¼›</li><li>*<strong>zlend*</strong>ï¼Œæ ‡è®°å‹ç¼©åˆ—è¡¨çš„ç»“æŸç‚¹ï¼Œå›ºå®šå€¼ 0xFFï¼ˆåè¿›åˆ¶255ï¼‰ã€‚</li></ul><p>åœ¨å‹ç¼©åˆ—è¡¨ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è¦æŸ¥æ‰¾å®šä½ç¬¬ä¸€ä¸ªå…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥é€šè¿‡è¡¨å¤´ä¸‰ä¸ªå­—æ®µï¼ˆzllenï¼‰çš„é•¿åº¦ç›´æ¥å®šä½ï¼Œå¤æ‚åº¦æ˜¯ O(1)ã€‚è€Œ<strong>æŸ¥æ‰¾å…¶ä»–å…ƒç´ æ—¶ï¼Œå°±æ²¡æœ‰è¿™ä¹ˆé«˜æ•ˆäº†ï¼Œåªèƒ½é€ä¸ªæŸ¥æ‰¾ï¼Œæ­¤æ—¶çš„å¤æ‚åº¦å°±æ˜¯ O(N) äº†ï¼Œå› æ­¤å‹ç¼©åˆ—è¡¨ä¸é€‚åˆä¿å­˜è¿‡å¤šçš„å…ƒç´ </strong>ã€‚</p><p>å¦å¤–ï¼Œå‹ç¼©åˆ—è¡¨èŠ‚ç‚¹ï¼ˆentryï¼‰çš„æ„æˆå¦‚ä¸‹ï¼š</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020723000.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹åŒ…å«ä¸‰éƒ¨åˆ†å†…å®¹ï¼š</p><ul><li>*<strong>prevlen*</strong>ï¼Œè®°å½•äº†ã€Œå‰ä¸€ä¸ªèŠ‚ç‚¹ã€çš„é•¿åº¦ï¼Œç›®çš„æ˜¯ä¸ºäº†å®ç°ä»åå‘å‰éå†ï¼›</li><li>*<strong>encoding*</strong>ï¼Œè®°å½•äº†å½“å‰èŠ‚ç‚¹å®é™…æ•°æ®çš„ã€Œç±»å‹å’Œé•¿åº¦ã€ï¼Œç±»å‹ä¸»è¦æœ‰ä¸¤ç§ï¼šå­—ç¬¦ä¸²å’Œæ•´æ•°ã€‚</li><li>*<strong>data*</strong>ï¼Œè®°å½•äº†å½“å‰èŠ‚ç‚¹çš„å®é™…æ•°æ®ï¼Œç±»å‹å’Œé•¿åº¦éƒ½ç”± encoding å†³å®šï¼›</li></ul><p>å½“æˆ‘ä»¬å¾€å‹ç¼©åˆ—è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œå‹ç¼©åˆ—è¡¨å°±ä¼šæ ¹æ®æ•°æ®ç±»å‹æ˜¯å­—ç¬¦ä¸²è¿˜æ˜¯æ•´æ•°ï¼Œä»¥åŠæ•°æ®çš„å¤§å°ï¼Œä¼šä½¿ç”¨ä¸åŒç©ºé—´å¤§å°çš„ prevlen å’Œ encoding è¿™ä¸¤ä¸ªå…ƒç´ é‡Œä¿å­˜çš„ä¿¡æ¯ï¼Œ<strong>è¿™ç§æ ¹æ®æ•°æ®å¤§å°å’Œç±»å‹è¿›è¡Œä¸åŒçš„ç©ºé—´å¤§å°åˆ†é…çš„è®¾è®¡æ€æƒ³ï¼Œæ­£æ˜¯ Redis ä¸ºäº†èŠ‚çœå†…å­˜è€Œé‡‡ç”¨çš„</strong>ã€‚</p><p>åˆ†åˆ«è¯´ä¸‹ï¼Œprevlen å’Œ encoding æ˜¯å¦‚ä½•æ ¹æ®æ•°æ®çš„å¤§å°å’Œç±»å‹æ¥è¿›è¡Œä¸åŒçš„ç©ºé—´å¤§å°åˆ†é…ã€‚</p><p>å‹ç¼©åˆ—è¡¨é‡Œçš„æ¯ä¸ªèŠ‚ç‚¹ä¸­çš„ prevlen å±æ€§éƒ½è®°å½•äº†ã€Œå‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ã€ï¼Œè€Œä¸” prevlen å±æ€§çš„ç©ºé—´å¤§å°è·Ÿå‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦å€¼æœ‰å…³ï¼Œæ¯”å¦‚ï¼š</p><ul><li>å¦‚æœ<strong>å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦å°äº 254 å­—èŠ‚</strong>ï¼Œé‚£ä¹ˆ prevlen å±æ€§éœ€è¦ç”¨ <strong>1 å­—èŠ‚çš„ç©ºé—´</strong>æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼›</li><li>å¦‚æœ<strong>å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦å¤§äºç­‰äº 254 å­—èŠ‚</strong>ï¼Œé‚£ä¹ˆ prevlen å±æ€§éœ€è¦ç”¨ <strong>5 å­—èŠ‚çš„ç©ºé—´</strong>æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼›</li></ul><p>encoding å±æ€§çš„ç©ºé—´å¤§å°è·Ÿæ•°æ®æ˜¯å­—ç¬¦ä¸²è¿˜æ˜¯æ•´æ•°ï¼Œä»¥åŠå­—ç¬¦ä¸²çš„é•¿åº¦æœ‰å…³ï¼Œå¦‚ä¸‹å›¾ï¼ˆä¸‹å›¾ä¸­çš„ content è¡¨ç¤ºçš„æ˜¯å®é™…æ•°æ®ï¼Œå³æœ¬æ–‡çš„ data å­—æ®µï¼‰ï¼š</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020723236.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ul><li>å¦‚æœ<strong>å½“å‰èŠ‚ç‚¹çš„æ•°æ®æ˜¯æ•´æ•°</strong>ï¼Œåˆ™ encoding ä¼šä½¿ç”¨ <strong>1 å­—èŠ‚çš„ç©ºé—´</strong>è¿›è¡Œç¼–ç ï¼Œä¹Ÿå°±æ˜¯ encoding é•¿åº¦ä¸º 1 å­—èŠ‚ã€‚é€šè¿‡ encoding ç¡®è®¤äº†æ•´æ•°ç±»å‹ï¼Œå°±å¯ä»¥ç¡®è®¤æ•´æ•°æ•°æ®çš„å®é™…å¤§å°äº†ï¼Œæ¯”å¦‚å¦‚æœ encoding ç¼–ç ç¡®è®¤äº†æ•°æ®æ˜¯ int16 æ•´æ•°ï¼Œé‚£ä¹ˆ data çš„é•¿åº¦å°±æ˜¯ int16 çš„å¤§å°ã€‚</li><li>å¦‚æœ<strong>å½“å‰èŠ‚ç‚¹çš„æ•°æ®æ˜¯å­—ç¬¦ä¸²ï¼Œæ ¹æ®å­—ç¬¦ä¸²çš„é•¿åº¦å¤§å°</strong>ï¼Œencoding ä¼šä½¿ç”¨ <strong>1 å­—èŠ‚/2å­—èŠ‚/5å­—èŠ‚çš„ç©ºé—´</strong>è¿›è¡Œç¼–ç ï¼Œencoding ç¼–ç çš„å‰ä¸¤ä¸ª bit è¡¨ç¤ºæ•°æ®çš„ç±»å‹ï¼Œåç»­çš„å…¶ä»– bit æ ‡è¯†å­—ç¬¦ä¸²æ•°æ®çš„å®é™…é•¿åº¦ï¼Œå³ data çš„é•¿åº¦ã€‚</li></ul><h2 id="è¿é”æ›´æ–°" tabindex="-1"><a class="header-anchor" href="#è¿é”æ›´æ–°" aria-hidden="true">#</a> è¿é”æ›´æ–°</h2><p>å‹ç¼©åˆ—è¡¨é™¤äº†æŸ¥æ‰¾å¤æ‚åº¦é«˜çš„é—®é¢˜ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ã€‚</p><p><strong>å‹ç¼©åˆ—è¡¨æ–°å¢æŸä¸ªå…ƒç´ æˆ–ä¿®æ”¹æŸä¸ªå…ƒç´ æ—¶ï¼Œå¦‚æœç©ºé—´ä¸å¤Ÿï¼Œå‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜ç©ºé—´å°±éœ€è¦é‡æ–°åˆ†é…ã€‚è€Œå½“æ–°æ’å…¥çš„å…ƒç´ è¾ƒå¤§æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´åç»­å…ƒç´ çš„ prevlen å ç”¨ç©ºé—´éƒ½å‘ç”Ÿå˜åŒ–ï¼Œä»è€Œå¼•èµ·ã€Œè¿é”æ›´æ–°ã€é—®é¢˜ï¼Œå¯¼è‡´æ¯ä¸ªå…ƒç´ çš„ç©ºé—´éƒ½è¦é‡æ–°åˆ†é…ï¼Œé€ æˆè®¿é—®å‹ç¼©åˆ—è¡¨æ€§èƒ½çš„ä¸‹é™</strong>ã€‚</p><p>å‰é¢æåˆ°ï¼Œå‹ç¼©åˆ—è¡¨èŠ‚ç‚¹çš„ prevlen å±æ€§ä¼šæ ¹æ®å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦è¿›è¡Œä¸åŒçš„ç©ºé—´å¤§å°åˆ†é…ï¼š</p><ul><li>å¦‚æœå‰ä¸€ä¸ª<strong>èŠ‚ç‚¹çš„é•¿åº¦å°äº 254 å­—èŠ‚</strong>ï¼Œé‚£ä¹ˆ prevlen å±æ€§éœ€è¦ç”¨ <strong>1 å­—èŠ‚çš„ç©ºé—´</strong>æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼›</li><li>å¦‚æœå‰ä¸€ä¸ª<strong>èŠ‚ç‚¹çš„é•¿åº¦å¤§äºç­‰äº 254 å­—èŠ‚</strong>ï¼Œé‚£ä¹ˆ prevlen å±æ€§éœ€è¦ç”¨ <strong>5 å­—èŠ‚çš„ç©ºé—´</strong>æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼›</li></ul><p>ç°åœ¨å‡è®¾ä¸€ä¸ªå‹ç¼©åˆ—è¡¨ä¸­æœ‰å¤šä¸ªè¿ç»­çš„ã€é•¿åº¦åœ¨ 250ï½253 ä¹‹é—´çš„èŠ‚ç‚¹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020723346.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å› ä¸ºè¿™äº›èŠ‚ç‚¹é•¿åº¦å€¼å°äº 254 å­—èŠ‚ï¼Œæ‰€ä»¥ prevlen å±æ€§éœ€è¦ç”¨ 1 å­—èŠ‚çš„ç©ºé—´æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ã€‚</p><p>è¿™æ—¶ï¼Œå¦‚æœå°†ä¸€ä¸ªé•¿åº¦å¤§äºç­‰äº 254 å­—èŠ‚çš„æ–°èŠ‚ç‚¹åŠ å…¥åˆ°å‹ç¼©åˆ—è¡¨çš„è¡¨å¤´èŠ‚ç‚¹ï¼Œå³æ–°èŠ‚ç‚¹å°†æˆä¸º e1 çš„å‰ç½®èŠ‚ç‚¹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724177.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å› ä¸º e1 èŠ‚ç‚¹çš„ prevlen å±æ€§åªæœ‰ 1 ä¸ªå­—èŠ‚å¤§å°ï¼Œæ— æ³•ä¿å­˜æ–°èŠ‚ç‚¹çš„é•¿åº¦ï¼Œæ­¤æ—¶å°±éœ€è¦å¯¹å‹ç¼©åˆ—è¡¨çš„ç©ºé—´é‡åˆ†é…æ“ä½œï¼Œå¹¶å°† e1 èŠ‚ç‚¹çš„ prevlen å±æ€§ä»åŸæ¥çš„ 1 å­—èŠ‚å¤§å°æ‰©å±•ä¸º 5 å­—èŠ‚å¤§å°ã€‚</p><p>å¤šç±³è¯ºç‰Œçš„æ•ˆåº”å°±æ­¤å¼€å§‹ã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724350.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>e1 åŸæœ¬çš„é•¿åº¦åœ¨ 250ï½253 ä¹‹é—´ï¼Œå› ä¸ºåˆšæ‰çš„æ‰©å±•ç©ºé—´ï¼Œæ­¤æ—¶ e1 çš„é•¿åº¦å°±å¤§äºç­‰äº 254 äº†ï¼Œå› æ­¤åŸæœ¬ e2 ä¿å­˜ e1 çš„ prevlen å±æ€§ä¹Ÿå¿…é¡»ä» 1 å­—èŠ‚æ‰©å±•è‡³ 5 å­—èŠ‚å¤§å°ã€‚</p><p>æ­£å¦‚æ‰©å±• e1 å¼•å‘äº†å¯¹ e2 æ‰©å±•ä¸€æ ·ï¼Œæ‰©å±• e2 ä¹Ÿä¼šå¼•å‘å¯¹ e3 çš„æ‰©å±•ï¼Œè€Œæ‰©å±• e3 åˆä¼šå¼•å‘å¯¹ e4 çš„æ‰©å±•.... ä¸€ç›´æŒç»­åˆ°ç»“å°¾ã€‚</p><p><strong>è¿™ç§åœ¨ç‰¹æ®Šæƒ…å†µä¸‹äº§ç”Ÿçš„è¿ç»­å¤šæ¬¡ç©ºé—´æ‰©å±•æ“ä½œå°±å«åšã€Œè¿é”æ›´æ–°ã€</strong>ï¼Œå°±åƒå¤šç±³è¯ºç‰Œçš„æ•ˆåº”ä¸€æ ·ï¼Œç¬¬ä¸€å¼ ç‰Œå€’ä¸‹äº†ï¼Œæ¨åŠ¨äº†ç¬¬äºŒå¼ ç‰Œå€’ä¸‹ï¼›ç¬¬äºŒå¼ ç‰Œå€’ä¸‹ï¼Œåˆæ¨åŠ¨äº†ç¬¬ä¸‰å¼ ç‰Œå€’ä¸‹....ï¼Œ</p><h2 id="å‹ç¼©åˆ—è¡¨çš„ç¼ºé™·" tabindex="-1"><a class="header-anchor" href="#å‹ç¼©åˆ—è¡¨çš„ç¼ºé™·" aria-hidden="true">#</a> å‹ç¼©åˆ—è¡¨çš„ç¼ºé™·</h2><p>ç©ºé—´æ‰©å±•æ“ä½œä¹Ÿå°±æ˜¯é‡æ–°åˆ†é…å†…å­˜ï¼Œå› æ­¤<strong>è¿é”æ›´æ–°ä¸€æ—¦å‘ç”Ÿï¼Œå°±ä¼šå¯¼è‡´å‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜ç©ºé—´è¦å¤šæ¬¡é‡æ–°åˆ†é…ï¼Œè¿™å°±ä¼šç›´æ¥å½±å“åˆ°å‹ç¼©åˆ—è¡¨çš„è®¿é—®æ€§èƒ½</strong>ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œ<strong>è™½ç„¶å‹ç¼©åˆ—è¡¨ç´§å‡‘å‹çš„å†…å­˜å¸ƒå±€èƒ½èŠ‚çœå†…å­˜å¼€é”€ï¼Œä½†æ˜¯å¦‚æœä¿å­˜çš„å…ƒç´ æ•°é‡å¢åŠ äº†ï¼Œæˆ–æ˜¯å…ƒç´ å˜å¤§äº†ï¼Œä¼šå¯¼è‡´å†…å­˜é‡æ–°åˆ†é…ï¼Œæœ€ç³Ÿç³•çš„æ˜¯ä¼šæœ‰ã€Œè¿é”æ›´æ–°ã€çš„é—®é¢˜</strong>ã€‚</p><p>å› æ­¤ï¼Œ<strong>å‹ç¼©åˆ—è¡¨åªä¼šç”¨äºä¿å­˜çš„èŠ‚ç‚¹æ•°é‡ä¸å¤šçš„åœºæ™¯</strong>ï¼Œåªè¦èŠ‚ç‚¹æ•°é‡è¶³å¤Ÿå°ï¼Œå³ä½¿å‘ç”Ÿè¿é”æ›´æ–°ï¼Œä¹Ÿæ˜¯èƒ½æ¥å—çš„ã€‚</p><p>è™½è¯´å¦‚æ­¤ï¼ŒRedis é’ˆå¯¹å‹ç¼©åˆ—è¡¨åœ¨è®¾è®¡ä¸Šçš„ä¸è¶³ï¼Œåœ¨åæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œæ–°å¢è®¾è®¡äº†ä¸¤ç§æ•°æ®ç»“æ„ï¼šquicklistï¼ˆRedis 3.2 å¼•å…¥ï¼‰ å’Œ listpackï¼ˆRedis 5.0 å¼•å…¥ï¼‰ã€‚è¿™ä¸¤ç§æ•°æ®ç»“æ„çš„è®¾è®¡ç›®æ ‡ï¼Œå°±æ˜¯å°½å¯èƒ½åœ°ä¿æŒå‹ç¼©åˆ—è¡¨èŠ‚çœå†…å­˜çš„ä¼˜åŠ¿ï¼ŒåŒæ—¶è§£å†³å‹ç¼©åˆ—è¡¨çš„ã€Œè¿é”æ›´æ–°ã€çš„é—®é¢˜ã€‚</p><h1 id="å“ˆå¸Œè¡¨" tabindex="-1"><a class="header-anchor" href="#å“ˆå¸Œè¡¨" aria-hidden="true">#</a> å“ˆå¸Œè¡¨</h1><p>å“ˆå¸Œè¡¨æ˜¯ä¸€ç§ä¿å­˜é”®å€¼å¯¹ï¼ˆkey-valueï¼‰çš„æ•°æ®ç»“æ„ã€‚</p><p>å“ˆå¸Œè¡¨ä¸­çš„æ¯ä¸€ä¸ª key éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œç¨‹åºå¯ä»¥æ ¹æ® key æŸ¥æ‰¾åˆ°ä¸ä¹‹å…³è”çš„ valueï¼Œæˆ–è€…é€šè¿‡ key æ¥æ›´æ–° valueï¼Œåˆæˆ–è€…æ ¹æ® key æ¥åˆ é™¤æ•´ä¸ª key-valueç­‰ç­‰ã€‚</p><p>åœ¨è®²å‹ç¼©åˆ—è¡¨çš„æ—¶å€™ï¼Œæåˆ°è¿‡ Redis çš„ Hash å¯¹è±¡çš„åº•å±‚å®ç°ä¹‹ä¸€æ˜¯å‹ç¼©åˆ—è¡¨ï¼ˆæœ€æ–° Redis ä»£ç å·²å°†å‹ç¼©åˆ—è¡¨æ›¿æ¢æˆ listpackï¼‰ã€‚Hash å¯¹è±¡çš„å¦å¤–ä¸€ä¸ªåº•å±‚å®ç°å°±æ˜¯å“ˆå¸Œè¡¨ã€‚</p><p>å“ˆå¸Œè¡¨ä¼˜ç‚¹åœ¨äºï¼Œå®ƒ<strong>èƒ½ä»¥ O(1) çš„å¤æ‚åº¦å¿«é€ŸæŸ¥è¯¢æ•°æ®</strong>ã€‚æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿå°† key é€šè¿‡ Hash å‡½æ•°çš„è®¡ç®—ï¼Œå°±èƒ½å®šä½æ•°æ®åœ¨è¡¨ä¸­çš„ä½ç½®ï¼Œ<strong>å› ä¸ºå“ˆå¸Œè¡¨å®é™…ä¸Šæ˜¯æ•°ç»„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ç´¢å¼•å€¼å¿«é€ŸæŸ¥è¯¢åˆ°æ•°æ®ã€‚</strong></p><p>ä½†æ˜¯å­˜åœ¨çš„é£é™©ä¹Ÿæ˜¯æœ‰ï¼Œåœ¨å“ˆå¸Œè¡¨å¤§å°å›ºå®šçš„æƒ…å†µä¸‹ï¼Œéšç€æ•°æ®ä¸æ–­å¢å¤šï¼Œé‚£ä¹ˆ<strong>å“ˆå¸Œå†²çª</strong>çš„å¯èƒ½æ€§ä¹Ÿä¼šè¶Šé«˜ã€‚</p><p>è§£å†³å“ˆå¸Œå†²çªçš„æ–¹å¼ï¼Œæœ‰å¾ˆå¤šç§ã€‚</p><p><strong>Redis é‡‡ç”¨äº†ã€Œé“¾å¼å“ˆå¸Œã€æ¥è§£å†³å“ˆå¸Œå†²çª</strong>ï¼Œåœ¨ä¸æ‰©å®¹å“ˆå¸Œè¡¨çš„å‰æä¸‹ï¼Œå°†å…·æœ‰ç›¸åŒå“ˆå¸Œå€¼çš„æ•°æ®ä¸²èµ·æ¥ï¼Œå½¢æˆé“¾è¡¨ï¼Œä»¥ä¾¿è¿™äº›æ•°æ®åœ¨è¡¨ä¸­ä»ç„¶å¯ä»¥è¢«æŸ¥è¯¢åˆ°ã€‚</p><h2 id="å“ˆå¸Œè¡¨ç»“æ„è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#å“ˆå¸Œè¡¨ç»“æ„è®¾è®¡" aria-hidden="true">#</a> å“ˆå¸Œè¡¨ç»“æ„è®¾è®¡</h2><p>Redis çš„å“ˆå¸Œè¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">dictht</span> <span class="token punctuation">{</span>
    <span class="token comment">//å“ˆå¸Œè¡¨æ•°ç»„</span>
    dictEntry <span class="token operator">*</span><span class="token operator">*</span>table<span class="token punctuation">;</span>
    <span class="token comment">//å“ˆå¸Œè¡¨å¤§å°</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> size<span class="token punctuation">;</span>  
    <span class="token comment">//å“ˆå¸Œè¡¨å¤§å°æ©ç ï¼Œç”¨äºè®¡ç®—ç´¢å¼•å€¼</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> sizemask<span class="token punctuation">;</span>
    <span class="token comment">//è¯¥å“ˆå¸Œè¡¨å·²æœ‰çš„èŠ‚ç‚¹æ•°é‡</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> used<span class="token punctuation">;</span>
<span class="token punctuation">}</span> dictht<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œå“ˆå¸Œè¡¨æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆdictEntry **tableï¼‰ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªæŒ‡å‘ã€Œå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼ˆdictEntryï¼‰ã€çš„æŒ‡é’ˆã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724828.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å“ˆå¸Œè¡¨èŠ‚ç‚¹çš„ç»“æ„å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">dictEntry</span> <span class="token punctuation">{</span>
    <span class="token comment">//é”®å€¼å¯¹ä¸­çš„é”®</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>key<span class="token punctuation">;</span>
  
    <span class="token comment">//é”®å€¼å¯¹ä¸­çš„å€¼</span>
    <span class="token keyword">union</span> <span class="token punctuation">{</span>
        <span class="token keyword">void</span> <span class="token operator">*</span>val<span class="token punctuation">;</span>
        <span class="token class-name">uint64_t</span> u64<span class="token punctuation">;</span>
        <span class="token class-name">int64_t</span> s64<span class="token punctuation">;</span>
        <span class="token keyword">double</span> d<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> v<span class="token punctuation">;</span>
    <span class="token comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œå½¢æˆé“¾è¡¨</span>
    <span class="token keyword">struct</span> <span class="token class-name">dictEntry</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>
<span class="token punctuation">}</span> dictEntry<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>dictEntry ç»“æ„é‡Œä¸ä»…åŒ…å«æŒ‡å‘é”®å’Œå€¼çš„æŒ‡é’ˆï¼Œè¿˜åŒ…å«äº†æŒ‡å‘ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆå¯ä»¥å°†å¤šä¸ªå“ˆå¸Œå€¼ç›¸åŒçš„é”®å€¼å¯¹é“¾æ¥èµ·æ¥ï¼Œä»¥æ­¤æ¥è§£å†³å“ˆå¸Œå†²çªçš„é—®é¢˜ï¼Œè¿™å°±æ˜¯é“¾å¼å“ˆå¸Œã€‚</p><p>dictEntry ç»“æ„é‡Œé”®å€¼å¯¹ä¸­çš„å€¼æ˜¯ä¸€ä¸ªã€Œè”åˆä½“ vã€å®šä¹‰çš„ï¼Œå› æ­¤ï¼Œé”®å€¼å¯¹ä¸­çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªæŒ‡å‘å®é™…å€¼çš„æŒ‡é’ˆï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„ 64 ä½æ•´æ•°æˆ–æœ‰ç¬¦å·çš„ 64 ä½æ•´æ•°æˆ–double ç±»çš„å€¼ã€‚è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå› ä¸ºå½“ã€Œå€¼ã€æ˜¯æ•´æ•°æˆ–æµ®ç‚¹æ•°æ—¶ï¼Œå°±å¯ä»¥å°†å€¼çš„æ•°æ®å†…åµŒåœ¨ dictEntry ç»“æ„é‡Œï¼Œæ— éœ€å†ç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å®é™…çš„å€¼ï¼Œä»è€ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚</p><h2 id="å“ˆå¸Œå†²çª" tabindex="-1"><a class="header-anchor" href="#å“ˆå¸Œå†²çª" aria-hidden="true">#</a> å“ˆå¸Œå†²çª</h2><p>å“ˆå¸Œè¡¨å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ å°±æ˜¯ä¸€ä¸ªå“ˆå¸Œæ¡¶ã€‚</p><p>å½“ä¸€ä¸ªé”®å€¼å¯¹çš„é”®ç»è¿‡ Hash å‡½æ•°è®¡ç®—åå¾—åˆ°å“ˆå¸Œå€¼ï¼Œå†å°†(å“ˆå¸Œå€¼ % å“ˆå¸Œè¡¨å¤§å°)å–æ¨¡è®¡ç®—ï¼Œå¾—åˆ°çš„ç»“æœå€¼å°±æ˜¯è¯¥ key-value å¯¹åº”çš„æ•°ç»„å…ƒç´ ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ç¬¬å‡ ä¸ªå“ˆå¸Œæ¡¶ã€‚</p><p>ä»€ä¹ˆæ˜¯å“ˆå¸Œå†²çªå‘¢ï¼Ÿ</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰ä¸€ä¸ªå¯ä»¥å­˜æ”¾ 8 ä¸ªå“ˆå¸Œæ¡¶çš„å“ˆå¸Œè¡¨ã€‚key1 ç»è¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—åï¼Œå†å°†ã€Œå“ˆå¸Œå€¼ % 8 ã€è¿›è¡Œå–æ¨¡è®¡ç®—ï¼Œç»“æœå€¼ä¸º 1ï¼Œé‚£ä¹ˆå°±å¯¹åº”å“ˆå¸Œæ¡¶ 1ï¼Œç±»ä¼¼çš„ï¼Œkey9 å’Œ key10 åˆ†åˆ«å¯¹åº”å“ˆå¸Œæ¡¶ 1 å’Œæ¡¶ 6ã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724394.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æ­¤æ—¶ï¼Œkey1 å’Œ key9 å¯¹åº”åˆ°äº†ç›¸åŒçš„å“ˆå¸Œæ¡¶ä¸­ï¼Œè¿™å°±å‘ç”Ÿäº†å“ˆå¸Œå†²çªã€‚</p><p>å› æ­¤ï¼Œ<strong>å½“æœ‰ä¸¤ä¸ªä»¥ä¸Šæ•°é‡çš„ key è¢«åˆ†é…åˆ°äº†å“ˆå¸Œè¡¨ä¸­åŒä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸Šæ—¶ï¼Œæ­¤æ—¶ç§°è¿™äº› key å‘ç”Ÿäº†å†²çªã€‚</strong></p><h2 id="é“¾å¼å“ˆå¸Œ" tabindex="-1"><a class="header-anchor" href="#é“¾å¼å“ˆå¸Œ" aria-hidden="true">#</a> é“¾å¼å“ˆå¸Œ</h2><p>Redis é‡‡ç”¨äº†ã€Œ<strong>é“¾å¼å“ˆå¸Œ</strong>ã€çš„æ–¹æ³•æ¥è§£å†³å“ˆå¸Œå†²çªã€‚</p><p>é“¾å¼å“ˆå¸Œæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</p><p>å®ç°çš„æ–¹å¼å°±æ˜¯æ¯ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ª next æŒ‡é’ˆï¼Œç”¨äºæŒ‡å‘ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œå› æ­¤å¤šä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹å¯ä»¥ç”¨ next æŒ‡é’ˆæ„æˆä¸€ä¸ªå•é¡¹é“¾è¡¨ï¼Œ<strong>è¢«åˆ†é…åˆ°åŒä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸Šçš„å¤šä¸ªèŠ‚ç‚¹å¯ä»¥ç”¨è¿™ä¸ªå•é¡¹é“¾è¡¨è¿æ¥èµ·æ¥</strong>ï¼Œè¿™æ ·å°±è§£å†³äº†å“ˆå¸Œå†²çªã€‚</p><p>è¿˜æ˜¯ç”¨å‰é¢çš„å“ˆå¸Œå†²çªä¾‹å­ï¼Œkey1 å’Œ key9 ç»è¿‡å“ˆå¸Œè®¡ç®—åï¼Œéƒ½è½åœ¨åŒä¸€ä¸ªå“ˆå¸Œæ¡¶ï¼Œé“¾å¼å“ˆå¸Œçš„è¯ï¼Œkey1 å°±ä¼šé€šè¿‡ next æŒ‡é’ˆæŒ‡å‘ key9ï¼Œå½¢æˆä¸€ä¸ªå•å‘é“¾è¡¨ã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724727.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ä¸è¿‡ï¼Œé“¾å¼å“ˆå¸Œå±€é™æ€§ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œéšç€é“¾è¡¨é•¿åº¦çš„å¢åŠ ï¼Œåœ¨æŸ¥è¯¢è¿™ä¸€ä½ç½®ä¸Šçš„æ•°æ®çš„è€—æ—¶å°±ä¼šå¢åŠ ï¼Œæ¯•ç«Ÿé“¾è¡¨çš„æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚</p><p>è¦æƒ³è§£å†³è¿™ä¸€é—®é¢˜ï¼Œå°±éœ€è¦è¿›è¡Œ rehashï¼Œä¹Ÿå°±æ˜¯å¯¹å“ˆå¸Œè¡¨çš„å¤§å°è¿›è¡Œæ‰©å±•ã€‚</p><h2 id="rehash" tabindex="-1"><a class="header-anchor" href="#rehash" aria-hidden="true">#</a> rehash</h2><p>å“ˆå¸Œè¡¨ç»“æ„è®¾è®¡çš„è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ç»™å¤§å®¶ä»‹ç»äº† Redis ä½¿ç”¨ dictht ç»“æ„ä½“è¡¨ç¤ºå“ˆå¸Œè¡¨ã€‚ä¸è¿‡ï¼Œåœ¨å®é™…ä½¿ç”¨å“ˆå¸Œè¡¨æ—¶ï¼ŒRedis å®šä¹‰ä¸€ä¸ª dict ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“é‡Œå®šä¹‰äº†<strong>ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼ˆht[2]ï¼‰</strong>ã€‚</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">dict</span> <span class="token punctuation">{</span>
    â€¦
    <span class="token comment">//ä¸¤ä¸ªHashè¡¨ï¼Œäº¤æ›¿ä½¿ç”¨ï¼Œç”¨äºrehashæ“ä½œ</span>
    dictht ht<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
    â€¦
<span class="token punctuation">}</span> dict<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹‹æ‰€ä»¥å®šä¹‰äº† 2 ä¸ªå“ˆå¸Œè¡¨ï¼Œæ˜¯å› ä¸ºè¿›è¡Œ rehash çš„æ—¶å€™ï¼Œéœ€è¦ç”¨ä¸Š 2 ä¸ªå“ˆå¸Œè¡¨ã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724561.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>åœ¨æ­£å¸¸æœåŠ¡è¯·æ±‚é˜¶æ®µï¼Œæ’å…¥çš„æ•°æ®ï¼Œéƒ½ä¼šå†™å…¥åˆ°ã€Œå“ˆå¸Œè¡¨ 1ã€ï¼Œæ­¤æ—¶çš„ã€Œå“ˆå¸Œè¡¨ 2 ã€ å¹¶æ²¡æœ‰è¢«åˆ†é…ç©ºé—´ã€‚</p><p>éšç€æ•°æ®é€æ­¥å¢å¤šï¼Œè§¦å‘äº† rehash æ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ul><li>ç»™ã€Œå“ˆå¸Œè¡¨ 2ã€ åˆ†é…ç©ºé—´ï¼Œä¸€èˆ¬ä¼šæ¯”ã€Œå“ˆå¸Œè¡¨ 1ã€ å¤§ 2 å€ï¼›</li><li>å°†ã€Œå“ˆå¸Œè¡¨ 1 ã€çš„æ•°æ®è¿ç§»åˆ°ã€Œå“ˆå¸Œè¡¨ 2ã€ ä¸­ï¼›</li><li>è¿ç§»å®Œæˆåï¼Œã€Œå“ˆå¸Œè¡¨ 1 ã€çš„ç©ºé—´ä¼šè¢«é‡Šæ”¾ï¼Œå¹¶æŠŠã€Œå“ˆå¸Œè¡¨ 2ã€ è®¾ç½®ä¸ºã€Œå“ˆå¸Œè¡¨ 1ã€ï¼Œç„¶ååœ¨ã€Œå“ˆå¸Œè¡¨ 2ã€ æ–°åˆ›å»ºä¸€ä¸ªç©ºç™½çš„å“ˆå¸Œè¡¨ï¼Œä¸ºä¸‹æ¬¡ rehash åšå‡†å¤‡ã€‚</li></ul><p>ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘æŠŠ rehash è¿™ä¸‰ä¸ªè¿‡ç¨‹ç”»åœ¨äº†ä¸‹é¢è¿™å¼ å›¾ï¼š</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724170.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>è¿™ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥ç®€å•ï¼Œä½†æ˜¯å…¶å®ç¬¬äºŒæ­¥å¾ˆæœ‰é—®é¢˜ï¼Œ<strong>å¦‚æœã€Œå“ˆå¸Œè¡¨ 1 ã€çš„æ•°æ®é‡éå¸¸å¤§ï¼Œé‚£ä¹ˆåœ¨è¿ç§»è‡³ã€Œå“ˆå¸Œè¡¨ 2 ã€çš„æ—¶å€™ï¼Œå› ä¸ºä¼šæ¶‰åŠå¤§é‡çš„æ•°æ®æ‹·è´ï¼Œæ­¤æ—¶å¯èƒ½ä¼šå¯¹ Redis é€ æˆé˜»å¡ï¼Œæ— æ³•æœåŠ¡å…¶ä»–è¯·æ±‚</strong>ã€‚</p><h2 id="æ¸è¿›å¼-rehash" tabindex="-1"><a class="header-anchor" href="#æ¸è¿›å¼-rehash" aria-hidden="true">#</a> æ¸è¿›å¼ rehash</h2><p>ä¸ºäº†é¿å… rehash åœ¨æ•°æ®è¿ç§»è¿‡ç¨‹ä¸­ï¼Œå› æ‹·è´æ•°æ®çš„è€—æ—¶ï¼Œå½±å“ Redis æ€§èƒ½çš„æƒ…å†µï¼Œæ‰€ä»¥ Redis é‡‡ç”¨äº†<strong>æ¸è¿›å¼ rehash</strong>ï¼Œä¹Ÿå°±æ˜¯å°†æ•°æ®çš„è¿ç§»çš„å·¥ä½œä¸å†æ˜¯ä¸€æ¬¡æ€§è¿ç§»å®Œæˆï¼Œè€Œæ˜¯åˆ†å¤šæ¬¡è¿ç§»ã€‚</p><p>æ¸è¿›å¼ rehash æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>ç»™ã€Œå“ˆå¸Œè¡¨ 2ã€ åˆ†é…ç©ºé—´ï¼›</li><li><strong>åœ¨ rehash è¿›è¡ŒæœŸé—´ï¼Œæ¯æ¬¡å“ˆå¸Œè¡¨å…ƒç´ è¿›è¡Œæ–°å¢ã€åˆ é™¤ã€æŸ¥æ‰¾æˆ–è€…æ›´æ–°æ“ä½œæ—¶ï¼ŒRedis é™¤äº†ä¼šæ‰§è¡Œå¯¹åº”çš„æ“ä½œä¹‹å¤–ï¼Œè¿˜ä¼šé¡ºåºå°†ã€Œå“ˆå¸Œè¡¨ 1 ã€ä¸­ç´¢å¼•ä½ç½®ä¸Šçš„æ‰€æœ‰ key-value è¿ç§»åˆ°ã€Œå“ˆå¸Œè¡¨ 2ã€ ä¸Š</strong>ï¼›</li><li>éšç€å¤„ç†å®¢æˆ·ç«¯å‘èµ·çš„å“ˆå¸Œè¡¨æ“ä½œè¯·æ±‚æ•°é‡è¶Šå¤šï¼Œæœ€ç»ˆåœ¨æŸä¸ªæ—¶é—´ç‚¹ä¼šæŠŠã€Œå“ˆå¸Œè¡¨ 1 ã€çš„æ‰€æœ‰ key-value è¿ç§»åˆ°ã€Œå“ˆå¸Œè¡¨ 2ã€ï¼Œä»è€Œå®Œæˆ rehash æ“ä½œã€‚</li></ul><p>è¿™æ ·å°±å·§å¦™åœ°æŠŠä¸€æ¬¡æ€§å¤§é‡æ•°æ®è¿ç§»å·¥ä½œçš„å¼€é”€ï¼Œåˆ†æ‘Šåˆ°äº†å¤šæ¬¡å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œé¿å…äº†ä¸€æ¬¡æ€§ rehash çš„è€—æ—¶æ“ä½œã€‚</p><p>åœ¨è¿›è¡Œæ¸è¿›å¼ rehash çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œæ‰€ä»¥åœ¨æ¸è¿›å¼ rehash è¿›è¡ŒæœŸé—´ï¼Œå“ˆå¸Œè¡¨å…ƒç´ çš„åˆ é™¤ã€æŸ¥æ‰¾ã€æ›´æ–°ç­‰æ“ä½œéƒ½ä¼šåœ¨è¿™ä¸¤ä¸ªå“ˆå¸Œè¡¨è¿›è¡Œã€‚</p><p>æ¯”å¦‚ï¼ŒæŸ¥æ‰¾ä¸€ä¸ª key çš„å€¼çš„è¯ï¼Œå…ˆä¼šåœ¨ã€Œå“ˆå¸Œè¡¨ 1ã€ é‡Œé¢è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±ä¼šç»§ç»­åˆ°å“ˆå¸Œè¡¨ 2 é‡Œé¢è¿›è¡Œæ‰¾åˆ°ã€‚</p><p>å¦å¤–ï¼Œåœ¨æ¸è¿›å¼ rehash è¿›è¡ŒæœŸé—´ï¼Œæ–°å¢ä¸€ä¸ª key-value æ—¶ï¼Œä¼šè¢«ä¿å­˜åˆ°ã€Œå“ˆå¸Œè¡¨ 2 ã€é‡Œé¢ï¼Œè€Œã€Œå“ˆå¸Œè¡¨ 1ã€ åˆ™ä¸å†è¿›è¡Œä»»ä½•æ·»åŠ æ“ä½œï¼Œè¿™æ ·ä¿è¯äº†ã€Œå“ˆå¸Œè¡¨ 1 ã€çš„ key-value æ•°é‡åªä¼šå‡å°‘ï¼Œéšç€ rehash æ“ä½œçš„å®Œæˆï¼Œæœ€ç»ˆã€Œå“ˆå¸Œè¡¨ 1 ã€å°±ä¼šå˜æˆç©ºè¡¨ã€‚</p><h2 id="rehash-è§¦å‘æ¡ä»¶" tabindex="-1"><a class="header-anchor" href="#rehash-è§¦å‘æ¡ä»¶" aria-hidden="true">#</a> rehash è§¦å‘æ¡ä»¶</h2><p>ä»‹ç»äº† rehash é‚£ä¹ˆå¤šï¼Œè¿˜æ²¡è¯´ä»€ä¹ˆæ—¶æƒ…å†µä¸‹ä¼šè§¦å‘ rehash æ“ä½œå‘¢ï¼Ÿ</p><p>rehash çš„è§¦å‘æ¡ä»¶è·Ÿè´Ÿè½½å› å­ï¼ˆload factorï¼‰æœ‰å…³ç³»ã€‚</p><p>è´Ÿè½½å› å­å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ä¸ªå…¬å¼è®¡ç®—ï¼š</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724327.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>è§¦å‘ rehash æ“ä½œçš„æ¡ä»¶ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªï¼š</p><ul><li><strong>å½“è´Ÿè½½å› å­å¤§äºç­‰äº 1 ï¼Œå¹¶ä¸” Redis æ²¡æœ‰åœ¨æ‰§è¡Œ bgsave å‘½ä»¤æˆ–è€… bgrewiteaof å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æ‰§è¡Œ RDB å¿«ç…§æˆ–æ²¡æœ‰è¿›è¡Œ AOF é‡å†™çš„æ—¶å€™ï¼Œå°±ä¼šè¿›è¡Œ rehash æ“ä½œã€‚</strong></li><li><strong>å½“è´Ÿè½½å› å­å¤§äºç­‰äº 5 æ—¶ï¼Œæ­¤æ—¶è¯´æ˜å“ˆå¸Œå†²çªéå¸¸ä¸¥é‡äº†ï¼Œä¸ç®¡æœ‰æ²¡æœ‰åœ¨æ‰§è¡Œ RDB å¿«ç…§æˆ– AOF é‡å†™ï¼Œéƒ½ä¼šå¼ºåˆ¶è¿›è¡Œ rehash æ“ä½œã€‚</strong></li></ul><h1 id="æ•´æ•°é›†åˆ" tabindex="-1"><a class="header-anchor" href="#æ•´æ•°é›†åˆ" aria-hidden="true">#</a> æ•´æ•°é›†åˆ</h1><p>æ•´æ•°é›†åˆæ˜¯ Set å¯¹è±¡çš„åº•å±‚å®ç°ä¹‹ä¸€ã€‚<strong>å½“ä¸€ä¸ª Set å¯¹è±¡åªåŒ…å«æ•´æ•°å€¼å…ƒç´ ï¼Œå¹¶ä¸”å…ƒç´ æ•°é‡ä¸å¤§æ—¶ï¼Œå°±ä¼šä½¿ç”¨æ•´æ•°é›†è¿™ä¸ªæ•°æ®ç»“æ„ä½œä¸ºåº•å±‚å®ç°ã€‚</strong></p><h2 id="æ•´æ•°é›†åˆç»“æ„è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#æ•´æ•°é›†åˆç»“æ„è®¾è®¡" aria-hidden="true">#</a> æ•´æ•°é›†åˆç»“æ„è®¾è®¡</h2><p><strong>æ•´æ•°é›†åˆæœ¬è´¨ä¸Šæ˜¯ä¸€å—è¿ç»­å†…å­˜ç©ºé—´</strong>ï¼Œå®ƒçš„ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">intset</span> <span class="token punctuation">{</span>
    <span class="token comment">//ç¼–ç æ–¹å¼</span>
    <span class="token class-name">uint32_t</span> encoding<span class="token punctuation">;</span>
    <span class="token comment">//é›†åˆåŒ…å«çš„å…ƒç´ æ•°é‡</span>
    <span class="token class-name">uint32_t</span> length<span class="token punctuation">;</span>
    <span class="token comment">//ä¿å­˜å…ƒç´ çš„æ•°ç»„</span>
    <span class="token class-name">int8_t</span> contents<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> intset<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œä¿å­˜å…ƒç´ çš„å®¹å™¨æ˜¯ä¸€ä¸ª contents æ•°ç»„ï¼Œè™½ç„¶ contents è¢«å£°æ˜ä¸º int8_t ç±»å‹çš„æ•°ç»„ï¼Œä½†æ˜¯å®é™…ä¸Š contents æ•°ç»„å¹¶ä¸ä¿å­˜ä»»ä½• int8_t ç±»å‹çš„å…ƒç´ ï¼Œcontents æ•°ç»„çš„çœŸæ­£ç±»å‹å–å†³äº intset ç»“æ„ä½“é‡Œçš„ encoding å±æ€§çš„å€¼ã€‚æ¯”å¦‚ï¼š</p><ul><li>å¦‚æœ encoding å±æ€§å€¼ä¸º INTSET_ENC_INT16ï¼Œé‚£ä¹ˆ contents å°±æ˜¯ä¸€ä¸ª int16_t ç±»å‹çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´ çš„ç±»å‹éƒ½æ˜¯ int16_tï¼›</li><li>å¦‚æœ encoding å±æ€§å€¼ä¸º INTSET_ENC_INT32ï¼Œé‚£ä¹ˆ contents å°±æ˜¯ä¸€ä¸ª int32_t ç±»å‹çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´ çš„ç±»å‹éƒ½æ˜¯ int32_tï¼›</li><li>å¦‚æœ encoding å±æ€§å€¼ä¸º INTSET_ENC_INT64ï¼Œé‚£ä¹ˆ contents å°±æ˜¯ä¸€ä¸ª int64_t ç±»å‹çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´ çš„ç±»å‹éƒ½æ˜¯ int64_tï¼›</li></ul><p>ä¸åŒç±»å‹çš„ contents æ•°ç»„ï¼Œæ„å‘³ç€æ•°ç»„çš„å¤§å°ä¹Ÿä¼šä¸åŒã€‚</p><h3 id="æ•´æ•°é›†åˆçš„å‡çº§æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#æ•´æ•°é›†åˆçš„å‡çº§æ“ä½œ" aria-hidden="true">#</a> æ•´æ•°é›†åˆçš„å‡çº§æ“ä½œ</h3><p>æ•´æ•°é›†åˆä¼šæœ‰ä¸€ä¸ªå‡çº§è§„åˆ™ï¼Œå°±æ˜¯å½“æˆ‘ä»¬å°†ä¸€ä¸ªæ–°å…ƒç´ åŠ å…¥åˆ°æ•´æ•°é›†åˆé‡Œé¢ï¼Œå¦‚æœæ–°å…ƒç´ çš„ç±»å‹ï¼ˆint32_tï¼‰æ¯”æ•´æ•°é›†åˆç°æœ‰æ‰€æœ‰å…ƒç´ çš„ç±»å‹ï¼ˆint16_tï¼‰éƒ½è¦é•¿æ—¶ï¼Œæ•´æ•°é›†åˆéœ€è¦å…ˆè¿›è¡Œå‡çº§ï¼Œä¹Ÿå°±æ˜¯æŒ‰æ–°å…ƒç´ çš„ç±»å‹ï¼ˆint32_tï¼‰æ‰©å±• contents æ•°ç»„çš„ç©ºé—´å¤§å°ï¼Œç„¶åæ‰èƒ½å°†æ–°å…ƒç´ åŠ å…¥åˆ°æ•´æ•°é›†åˆé‡Œï¼Œå½“ç„¶å‡çº§çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿè¦ç»´æŒæ•´æ•°é›†åˆçš„æœ‰åºæ€§ã€‚</p><p>æ•´æ•°é›†åˆå‡çº§çš„è¿‡ç¨‹ä¸ä¼šé‡æ–°åˆ†é…ä¸€ä¸ªæ–°ç±»å‹çš„æ•°ç»„ï¼Œè€Œæ˜¯åœ¨åŸæœ¬çš„æ•°ç»„ä¸Šæ‰©å±•ç©ºé—´ï¼Œç„¶ååœ¨å°†æ¯ä¸ªå…ƒç´ æŒ‰é—´éš”ç±»å‹å¤§å°åˆ†å‰²ï¼Œå¦‚æœ encoding å±æ€§å€¼ä¸º INTSET_ENC_INT16ï¼Œåˆ™æ¯ä¸ªå…ƒç´ çš„é—´éš”å°±æ˜¯ 16 ä½ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªæ•´æ•°é›†åˆé‡Œæœ‰ 3 ä¸ªç±»å‹ä¸º int16_t çš„å…ƒç´ ã€‚</p><figure><img src="https://cdn.nlark.com/yuque/0/2023/png/25684216/1684680952542-fd63827f-19ee-45d1-844e-6e9a33cb3194.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ç°åœ¨ï¼Œå¾€è¿™ä¸ªæ•´æ•°é›†åˆä¸­åŠ å…¥ä¸€ä¸ªæ–°å…ƒç´  65535ï¼Œè¿™ä¸ªæ–°å…ƒç´ éœ€è¦ç”¨ int32_t ç±»å‹æ¥ä¿å­˜ï¼Œæ‰€ä»¥æ•´æ•°é›†åˆè¦è¿›è¡Œå‡çº§æ“ä½œï¼Œé¦–å…ˆéœ€è¦ä¸º contents æ•°ç»„æ‰©å®¹ï¼Œ<strong>åœ¨åŸæœ¬ç©ºé—´çš„å¤§å°ä¹‹ä¸Šå†æ‰©å®¹å¤š 80 ä½ï¼ˆ4x32-3x16=80ï¼‰ï¼Œè¿™æ ·å°±èƒ½ä¿å­˜ä¸‹ 4 ä¸ªç±»å‹ä¸º int32_t çš„å…ƒç´ </strong>ã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724212.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æ‰©å®¹å®Œ contents æ•°ç»„ç©ºé—´å¤§å°åï¼Œéœ€è¦å°†ä¹‹å‰çš„ä¸‰ä¸ªå…ƒç´ è½¬æ¢ä¸º int32_t ç±»å‹ï¼Œå¹¶å°†è½¬æ¢åçš„å…ƒç´ æ”¾ç½®åˆ°æ­£ç¡®çš„ä½ä¸Šé¢ï¼Œå¹¶ä¸”éœ€è¦ç»´æŒåº•å±‚æ•°ç»„çš„æœ‰åºæ€§ä¸å˜ï¼Œæ•´ä¸ªè½¬æ¢è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><figure><img src="https://cdn.nlark.com/yuque/0/2023/png/25684216/1684680953112-0eefd6a0-eefd-450a-abe5-4651ca1bb90a.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æ•´æ•°é›†åˆå‡çº§æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</p><p>å¦‚æœè¦è®©ä¸€ä¸ªæ•°ç»„åŒæ—¶ä¿å­˜ int16_tã€int32_tã€int64_t ç±»å‹çš„å…ƒç´ ï¼Œæœ€ç®€å•åšæ³•å°±æ˜¯ç›´æ¥ä½¿ç”¨ int64_t ç±»å‹çš„æ•°ç»„ã€‚ä¸è¿‡è¿™æ ·çš„è¯ï¼Œå½“å¦‚æœå…ƒç´ éƒ½æ˜¯ int16_t ç±»å‹çš„ï¼Œå°±ä¼šé€ æˆå†…å­˜æµªè´¹çš„æƒ…å†µã€‚</p><p>æ•´æ•°é›†åˆå‡çº§å°±èƒ½é¿å…è¿™ç§æƒ…å†µï¼Œå¦‚æœä¸€ç›´å‘æ•´æ•°é›†åˆæ·»åŠ  int16_t ç±»å‹çš„å…ƒç´ ï¼Œé‚£ä¹ˆæ•´æ•°é›†åˆçš„åº•å±‚å®ç°å°±ä¸€ç›´æ˜¯ç”¨ int16_t ç±»å‹çš„æ•°ç»„ï¼Œåªæœ‰åœ¨æˆ‘ä»¬è¦å°† int32_t ç±»å‹æˆ– int64_t ç±»å‹çš„å…ƒç´ æ·»åŠ åˆ°é›†åˆæ—¶ï¼Œæ‰ä¼šå¯¹æ•°ç»„è¿›è¡Œå‡çº§æ“ä½œã€‚</p><p>å› æ­¤ï¼Œ<strong>æ•´æ•°é›†åˆå‡çº§çš„å¥½å¤„æ˜¯<strong><strong>èŠ‚çœå†…å­˜èµ„æº</strong></strong>ã€‚</strong></p><p>æ•´æ•°é›†åˆæ”¯æŒé™çº§æ“ä½œå—ï¼Ÿ</p><p><strong>ä¸æ”¯æŒé™çº§æ“ä½œ</strong>ï¼Œä¸€æ—¦å¯¹æ•°ç»„è¿›è¡Œäº†å‡çº§ï¼Œå°±ä¼šä¸€ç›´ä¿æŒå‡çº§åçš„çŠ¶æ€ã€‚æ¯”å¦‚å‰é¢çš„å‡çº§æ“ä½œçš„ä¾‹å­ï¼Œå¦‚æœåˆ é™¤äº† 65535 å…ƒç´ ï¼Œæ•´æ•°é›†åˆçš„æ•°ç»„è¿˜æ˜¯ int32_t ç±»å‹çš„ï¼Œå¹¶ä¸ä¼šå› æ­¤é™çº§ä¸º int16_t ç±»å‹ã€‚</p><hr><h1 id="è·³è¡¨" tabindex="-1"><a class="header-anchor" href="#è·³è¡¨" aria-hidden="true">#</a> è·³è¡¨</h1><p>Redis åªæœ‰ Zset å¯¹è±¡çš„åº•å±‚å®ç°ç”¨åˆ°äº†è·³è¡¨ï¼Œ<strong>è·³è¡¨çš„ä¼˜åŠ¿æ˜¯èƒ½æ”¯æŒå¹³å‡ O(logN) å¤æ‚åº¦çš„èŠ‚ç‚¹æŸ¥æ‰¾ã€‚</strong></p><p>zset ç»“æ„ä½“é‡Œæœ‰ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼šä¸€ä¸ªæ˜¯è·³è¡¨ï¼Œä¸€ä¸ªæ˜¯å“ˆå¸Œè¡¨ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯æ—¢èƒ½è¿›è¡Œé«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢ï¼Œä¹Ÿèƒ½è¿›è¡Œé«˜æ•ˆå•ç‚¹æŸ¥è¯¢ã€‚</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">zset</span> <span class="token punctuation">{</span>
    dict <span class="token operator">*</span>dict<span class="token punctuation">;</span>
    zskiplist <span class="token operator">*</span>zsl<span class="token punctuation">;</span>
<span class="token punctuation">}</span> zset<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Zset å¯¹è±¡åœ¨æ‰§è¡Œæ•°æ®æ’å…¥æˆ–æ˜¯æ•°æ®æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œä¼šä¾æ¬¡åœ¨è·³è¡¨å’Œå“ˆå¸Œè¡¨ä¸­æ’å…¥æˆ–æ›´æ–°ç›¸åº”çš„æ•°æ®ï¼Œä»è€Œä¿è¯äº†è·³è¡¨å’Œå“ˆå¸Œè¡¨ä¸­è®°å½•çš„ä¿¡æ¯ä¸€è‡´ã€‚</p><p>Zset å¯¹è±¡èƒ½æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ ZRANGEBYSCORE æ“ä½œï¼‰ï¼Œè¿™æ˜¯å› ä¸ºå®ƒçš„æ•°æ®ç»“æ„è®¾è®¡é‡‡ç”¨äº†è·³è¡¨ï¼Œè€Œåˆèƒ½ä»¥å¸¸æ•°å¤æ‚åº¦è·å–å…ƒç´ æƒé‡ï¼ˆå¦‚ ZSCORE æ“ä½œï¼‰ï¼Œè¿™æ˜¯å› ä¸ºå®ƒåŒæ—¶é‡‡ç”¨äº†å“ˆå¸Œè¡¨è¿›è¡Œç´¢å¼•ã€‚</p><p>å¯èƒ½å¾ˆå¤šäººä¼šå¥‡æ€ªï¼Œä¸ºä»€ä¹ˆæˆ‘å¼€å¤´è¯´ Zset å¯¹è±¡çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ã€Œå‹ç¼©åˆ—è¡¨ã€æˆ–è€…ã€Œè·³è¡¨ã€ï¼Œè€Œæ²¡æœ‰è¯´å“ˆå¸Œè¡¨å‘¢ï¼Ÿ</p><p>Zset å¯¹è±¡åœ¨ä½¿ç”¨è·³è¡¨ä½œä¸ºæ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œæ˜¯ä½¿ç”¨ç”±ã€Œå“ˆå¸Œè¡¨+è·³è¡¨ã€ç»„æˆçš„ struct zsetï¼Œä½†æ˜¯æˆ‘ä»¬è®¨è®ºçš„æ—¶å€™ï¼Œéƒ½ä¼šè¯´è·³è¡¨æ˜¯ Zset å¯¹è±¡çš„åº•å±‚æ•°æ®ç»“æ„ï¼Œè€Œä¸ä¼šæåŠå“ˆå¸Œè¡¨ï¼Œæ˜¯å› ä¸º struct zset ä¸­çš„<strong>å“ˆå¸Œè¡¨åªæ˜¯ç”¨äºä»¥å¸¸æ•°å¤æ‚åº¦è·å–å…ƒç´ æƒé‡ï¼Œå¤§éƒ¨åˆ†æ“ä½œéƒ½æ˜¯è·³è¡¨å®ç°çš„ã€‚</strong></p><h2 id="è·³è¡¨ç»“æ„è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#è·³è¡¨ç»“æ„è®¾è®¡" aria-hidden="true">#</a> è·³è¡¨ç»“æ„è®¾è®¡</h2><p>é“¾è¡¨åœ¨æŸ¥æ‰¾å…ƒç´ çš„æ—¶å€™ï¼Œå› ä¸ºéœ€è¦é€ä¸€æŸ¥æ‰¾ï¼Œæ‰€ä»¥æŸ¥è¯¢æ•ˆç‡éå¸¸ä½ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(N)ï¼Œäºæ˜¯å°±å‡ºç°äº†è·³è¡¨ã€‚<strong>è·³è¡¨æ˜¯åœ¨é“¾è¡¨åŸºç¡€ä¸Šæ”¹è¿›è¿‡æ¥çš„ï¼Œå®ç°äº†ä¸€ç§ã€Œå¤šå±‚ã€çš„æœ‰åºé“¾è¡¨</strong>**ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯èƒ½å¿«è¯»å®šä½æ•°æ®ã€‚**</p><p>é‚£è·³è¡¨é•¿ä»€ä¹ˆæ ·å‘¢ï¼Ÿæˆ‘è¿™é‡Œä¸¾ä¸ªä¾‹å­ï¼Œä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªå±‚çº§ä¸º 3 çš„è·³è¡¨ã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724962.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å›¾ä¸­å¤´èŠ‚ç‚¹æœ‰ L0~L2 ä¸‰ä¸ªå¤´æŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘äº†ä¸åŒå±‚çº§çš„èŠ‚ç‚¹ï¼Œç„¶åæ¯ä¸ªå±‚çº§çš„èŠ‚ç‚¹éƒ½é€šè¿‡æŒ‡é’ˆè¿æ¥èµ·æ¥ï¼š</p><ul><li>L0 å±‚çº§å…±æœ‰ 5 ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯èŠ‚ç‚¹1ã€2ã€3ã€4ã€5ï¼›</li><li>L1 å±‚çº§å…±æœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯èŠ‚ç‚¹ 2ã€3ã€5ï¼›</li><li>L2 å±‚çº§åªæœ‰ 1 ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯èŠ‚ç‚¹ 3 ã€‚</li></ul><p>å¦‚æœæˆ‘ä»¬è¦åœ¨é“¾è¡¨ä¸­æŸ¥æ‰¾èŠ‚ç‚¹ 4 è¿™ä¸ªå…ƒç´ ï¼Œåªèƒ½ä»å¤´å¼€å§‹éå†é“¾è¡¨ï¼Œéœ€è¦æŸ¥æ‰¾ 4 æ¬¡ï¼Œè€Œä½¿ç”¨äº†è·³è¡¨åï¼Œåªéœ€è¦æŸ¥æ‰¾ 2 æ¬¡å°±èƒ½å®šä½åˆ°èŠ‚ç‚¹ 4ï¼Œå› ä¸ºå¯ä»¥åœ¨å¤´èŠ‚ç‚¹ç›´æ¥ä» L2 å±‚çº§è·³åˆ°èŠ‚ç‚¹ 3ï¼Œç„¶åå†å¾€å‰éå†æ‰¾åˆ°èŠ‚ç‚¹ 4ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ª<strong>æŸ¥æ‰¾è¿‡ç¨‹å°±æ˜¯åœ¨å¤šä¸ªå±‚çº§ä¸Šè·³æ¥è·³å»ï¼Œæœ€åå®šä½åˆ°å…ƒç´ ã€‚å½“æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œè·³è¡¨çš„æŸ¥æ‰¾å¤æ‚åº¦å°±æ˜¯ O(logN)ã€‚</strong></p><p>é‚£è·³è¡¨èŠ‚ç‚¹æ˜¯æ€ä¹ˆå®ç°å¤šå±‚çº§çš„å‘¢ï¼Ÿè¿™å°±éœ€è¦çœ‹ã€Œè·³è¡¨èŠ‚ç‚¹ã€çš„æ•°æ®ç»“æ„äº†ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">zskiplistNode</span> <span class="token punctuation">{</span>
    <span class="token comment">//Zset å¯¹è±¡çš„å…ƒç´ å€¼</span>
    sds ele<span class="token punctuation">;</span>
    <span class="token comment">//å…ƒç´ æƒé‡å€¼</span>
    <span class="token keyword">double</span> score<span class="token punctuation">;</span>
    <span class="token comment">//åå‘æŒ‡é’ˆ</span>
    <span class="token keyword">struct</span> <span class="token class-name">zskiplistNode</span> <span class="token operator">*</span>backward<span class="token punctuation">;</span>
  
    <span class="token comment">//èŠ‚ç‚¹çš„levelæ•°ç»„ï¼Œä¿å­˜æ¯å±‚ä¸Šçš„å‰å‘æŒ‡é’ˆå’Œè·¨åº¦</span>
    <span class="token keyword">struct</span> <span class="token class-name">zskiplistLevel</span> <span class="token punctuation">{</span>
        <span class="token keyword">struct</span> <span class="token class-name">zskiplistNode</span> <span class="token operator">*</span>forward<span class="token punctuation">;</span>
        <span class="token keyword">unsigned</span> <span class="token keyword">long</span> span<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> level<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> zskiplistNode<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Zset å¯¹è±¡è¦åŒæ—¶ä¿å­˜ã€Œå…ƒç´ ã€å’Œã€Œå…ƒç´ çš„æƒé‡ã€ï¼Œå¯¹åº”åˆ°è·³è¡¨èŠ‚ç‚¹ç»“æ„é‡Œå°±æ˜¯ sds ç±»å‹çš„ ele å˜é‡å’Œ double ç±»å‹çš„ score å˜é‡ã€‚æ¯ä¸ªè·³è¡¨èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªåå‘æŒ‡é’ˆï¼ˆstruct zskiplistNode *backwardï¼‰ï¼ŒæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿ä»è·³è¡¨çš„å°¾èŠ‚ç‚¹å¼€å§‹è®¿é—®èŠ‚ç‚¹ï¼Œè¿™æ ·å€’åºæŸ¥æ‰¾æ—¶å¾ˆæ–¹ä¾¿ã€‚</p><p>è·³è¡¨æ˜¯ä¸€ä¸ªå¸¦æœ‰å±‚çº§å…³ç³»çš„é“¾è¡¨ï¼Œè€Œä¸”æ¯ä¸€å±‚çº§å¯ä»¥åŒ…å«å¤šä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹é€šè¿‡æŒ‡é’ˆè¿æ¥èµ·æ¥ï¼Œå®ç°è¿™ä¸€ç‰¹æ€§å°±æ˜¯é è·³è¡¨èŠ‚ç‚¹ç»“æ„ä½“ä¸­çš„<strong>zskiplistLevel ç»“æ„ä½“ç±»å‹çš„ level æ•°ç»„</strong>ã€‚</p><p><strong>level æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä»£è¡¨è·³è¡¨çš„ä¸€å±‚</strong>ï¼Œä¹Ÿå°±æ˜¯ç”± zskiplistLevel ç»“æ„ä½“è¡¨ç¤ºï¼Œæ¯”å¦‚ leve[0] å°±è¡¨ç¤ºç¬¬ä¸€å±‚ï¼Œleve[1] å°±è¡¨ç¤ºç¬¬äºŒå±‚ã€‚<strong>zskiplistLevel ç»“æ„ä½“é‡Œå®šä¹‰äº†ã€ŒæŒ‡å‘ä¸‹ä¸€ä¸ªè·³è¡¨èŠ‚ç‚¹çš„æŒ‡é’ˆã€å’Œã€Œè·¨åº¦ã€ï¼Œè·¨åº¦æ—¶ç”¨æ¥è®°å½•ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚</strong></p><p>æ¯”å¦‚ï¼Œä¸‹é¢è¿™å¼ å›¾ï¼Œå±•ç¤ºäº†å„ä¸ªèŠ‚ç‚¹çš„è·¨åº¦ã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724457.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ç¬¬ä¸€çœ¼çœ‹åˆ°è·¨åº¦çš„æ—¶å€™ï¼Œä»¥ä¸ºæ˜¯éå†æ“ä½œæœ‰å…³ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œéå†æ“ä½œåªéœ€è¦ç”¨å‰å‘æŒ‡é’ˆï¼ˆstruct zskiplistNode *forwardï¼‰å°±å¯ä»¥å®Œæˆäº†ã€‚</p><p><strong>è·¨åº¦å®é™…ä¸Šæ˜¯ä¸ºäº†è®¡ç®—è¿™ä¸ªèŠ‚ç‚¹åœ¨è·³è¡¨ä¸­çš„æ’ä½</strong>ã€‚å…·ä½“æ€ä¹ˆåšçš„å‘¢ï¼Ÿå› ä¸º<strong>è·³è¡¨ä¸­çš„èŠ‚ç‚¹éƒ½æ˜¯æŒ‰åºæ’åˆ—çš„ï¼Œé‚£ä¹ˆè®¡ç®—æŸä¸ªèŠ‚ç‚¹æ’ä½çš„æ—¶å€™ï¼Œä»å¤´èŠ‚ç‚¹åˆ°è¯¥ç»“ç‚¹çš„æŸ¥è¯¢è·¯å¾„ä¸Šï¼Œå°†æ²¿é€”è®¿é—®è¿‡çš„æ‰€æœ‰å±‚çš„è·¨åº¦ç´¯åŠ èµ·æ¥ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯ç›®æ ‡èŠ‚ç‚¹åœ¨è·³è¡¨ä¸­çš„æ’ä½ã€‚</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼ŒæŸ¥æ‰¾å›¾ä¸­èŠ‚ç‚¹ 3 åœ¨è·³è¡¨ä¸­çš„æ’ä½ï¼Œä»å¤´èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾èŠ‚ç‚¹ 3ï¼ŒæŸ¥æ‰¾çš„è¿‡ç¨‹åªç»è¿‡äº†ä¸€ä¸ªå±‚ï¼ˆL2ï¼‰ï¼Œå¹¶ä¸”å±‚çš„è·¨åº¦æ˜¯ 3ï¼Œæ‰€ä»¥èŠ‚ç‚¹ 3 åœ¨è·³è¡¨ä¸­çš„æ’ä½æ˜¯ 3ã€‚</p><p>å¦å¤–ï¼Œå›¾ä¸­çš„å¤´èŠ‚ç‚¹å…¶å®ä¹Ÿæ˜¯ zskiplistNode è·³è¡¨èŠ‚ç‚¹ï¼Œåªä¸è¿‡å¤´èŠ‚ç‚¹çš„åå‘æŒ‡é’ˆã€æƒé‡ã€å…ƒç´ å€¼éƒ½æ²¡æœ‰ç”¨åˆ°ï¼Œæ‰€ä»¥å›¾ä¸­çœç•¥äº†è¿™éƒ¨åˆ†ã€‚</p><p>é—®é¢˜æ¥äº†ï¼Œç”±è°å®šä¹‰å“ªä¸ªè·³è¡¨èŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹å‘¢ï¼Ÿè¿™å°±ä»‹ç»ã€Œè·³è¡¨ã€ç»“æ„ä½“äº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">zskiplist</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">zskiplistNode</span> <span class="token operator">*</span>header<span class="token punctuation">,</span> <span class="token operator">*</span>tail<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> length<span class="token punctuation">;</span>
    <span class="token keyword">int</span> level<span class="token punctuation">;</span>
<span class="token punctuation">}</span> zskiplist<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è·³è¡¨ç»“æ„é‡ŒåŒ…å«äº†ï¼š</p><ul><li>è·³è¡¨çš„å¤´å°¾èŠ‚ç‚¹ï¼Œä¾¿äºåœ¨O(1)æ—¶é—´å¤æ‚åº¦å†…è®¿é—®è·³è¡¨çš„å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹ï¼›</li><li>è·³è¡¨çš„é•¿åº¦ï¼Œä¾¿äºåœ¨O(1)æ—¶é—´å¤æ‚åº¦è·å–è·³è¡¨èŠ‚ç‚¹çš„æ•°é‡ï¼›</li><li>è·³è¡¨çš„æœ€å¤§å±‚æ•°ï¼Œä¾¿äºåœ¨O(1)æ—¶é—´å¤æ‚åº¦è·å–è·³è¡¨ä¸­å±‚é«˜æœ€å¤§çš„é‚£ä¸ªèŠ‚ç‚¹çš„å±‚æ•°é‡ï¼›</li></ul><h2 id="è·³è¡¨èŠ‚ç‚¹æŸ¥è¯¢è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#è·³è¡¨èŠ‚ç‚¹æŸ¥è¯¢è¿‡ç¨‹" aria-hidden="true">#</a> è·³è¡¨èŠ‚ç‚¹æŸ¥è¯¢è¿‡ç¨‹</h2><p><strong>æŸ¥æ‰¾ä¸€ä¸ªè·³è¡¨èŠ‚ç‚¹çš„è¿‡ç¨‹æ—¶ï¼Œè·³è¡¨ä¼šä»å¤´èŠ‚ç‚¹çš„æœ€é«˜å±‚å¼€å§‹ï¼Œé€ä¸€éå†æ¯ä¸€å±‚ã€‚åœ¨éå†æŸä¸€å±‚çš„è·³è¡¨èŠ‚ç‚¹æ—¶ï¼Œä¼šç”¨è·³è¡¨èŠ‚ç‚¹ä¸­çš„ SDS ç±»å‹çš„å…ƒç´ å’Œå…ƒç´ çš„æƒé‡æ¥è¿›è¡Œåˆ¤æ–­</strong>ï¼Œå…±æœ‰ä¸¤ä¸ªåˆ¤æ–­æ¡ä»¶ï¼š</p><ul><li>å¦‚æœå½“å‰èŠ‚ç‚¹çš„æƒé‡ã€Œå°äºã€è¦æŸ¥æ‰¾çš„æƒé‡æ—¶ï¼Œè·³è¡¨å°±ä¼šè®¿é—®è¯¥å±‚ä¸Šçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li><li>å¦‚æœå½“å‰èŠ‚ç‚¹çš„æƒé‡ã€Œç­‰äºã€è¦æŸ¥æ‰¾çš„æƒé‡æ—¶ï¼Œå¹¶ä¸”å½“å‰èŠ‚ç‚¹çš„ SDS ç±»å‹æ•°æ®ã€Œå°äºã€è¦æŸ¥æ‰¾çš„æ•°æ®æ—¶ï¼Œè·³è¡¨å°±ä¼šè®¿é—®è¯¥å±‚ä¸Šçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li></ul><p>å¦‚æœä¸Šé¢ä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œæˆ–è€…ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©ºæ—¶ï¼Œè·³è¡¨å°±ä¼šä½¿ç”¨ç›®å‰éå†åˆ°çš„èŠ‚ç‚¹çš„ level æ•°ç»„é‡Œçš„ä¸‹ä¸€å±‚æŒ‡é’ˆï¼Œç„¶åæ²¿ç€ä¸‹ä¸€å±‚æŒ‡é’ˆç»§ç»­æŸ¥æ‰¾ï¼Œè¿™å°±ç›¸å½“äºè·³åˆ°äº†ä¸‹ä¸€å±‚æ¥ç€æŸ¥æ‰¾ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹å›¾æœ‰ä¸ª 3 å±‚çº§çš„è·³è¡¨ã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724156.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¦‚æœè¦æŸ¥æ‰¾ã€Œå…ƒç´ ï¼šabcdï¼Œæƒé‡ï¼š4ã€çš„èŠ‚ç‚¹ï¼ŒæŸ¥æ‰¾çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>å…ˆä»å¤´èŠ‚ç‚¹çš„æœ€é«˜å±‚å¼€å§‹ï¼ŒL2 æŒ‡å‘äº†ã€Œå…ƒç´ ï¼šabcï¼Œæƒé‡ï¼š3ã€èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹çš„æƒé‡æ¯”è¦æŸ¥æ‰¾èŠ‚ç‚¹çš„å°ï¼Œæ‰€ä»¥è¦è®¿é—®è¯¥å±‚ä¸Šçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼›</li><li>ä½†æ˜¯è¯¥å±‚çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ç©ºèŠ‚ç‚¹ï¼ˆ leve[2]æŒ‡å‘çš„æ˜¯ç©ºèŠ‚ç‚¹ï¼‰ï¼Œäºæ˜¯å°±ä¼šè·³åˆ°ã€Œå…ƒç´ ï¼šabcï¼Œæƒé‡ï¼š3ã€èŠ‚ç‚¹çš„ä¸‹ä¸€å±‚å»æ‰¾ï¼Œä¹Ÿå°±æ˜¯ leve[1];</li><li>ã€Œå…ƒç´ ï¼šabcï¼Œæƒé‡ï¼š3ã€èŠ‚ç‚¹çš„ leve[1] çš„ä¸‹ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘äº†ã€Œå…ƒç´ ï¼šabcdeï¼Œæƒé‡ï¼š4ã€çš„èŠ‚ç‚¹ï¼Œç„¶åå°†å…¶å’Œè¦æŸ¥æ‰¾çš„èŠ‚ç‚¹æ¯”è¾ƒã€‚è™½ç„¶ã€Œå…ƒç´ ï¼šabcdeï¼Œæƒé‡ï¼š4ã€çš„èŠ‚ç‚¹çš„æƒé‡å’Œè¦æŸ¥æ‰¾çš„æƒé‡ç›¸åŒï¼Œä½†æ˜¯å½“å‰èŠ‚ç‚¹çš„ SDS ç±»å‹æ•°æ®ã€Œå¤§äºã€è¦æŸ¥æ‰¾çš„æ•°æ®ï¼Œæ‰€ä»¥ä¼šç»§ç»­è·³åˆ°ã€Œå…ƒç´ ï¼šabcï¼Œæƒé‡ï¼š3ã€èŠ‚ç‚¹çš„ä¸‹ä¸€å±‚å»æ‰¾ï¼Œä¹Ÿå°±æ˜¯ leve[0]ï¼›</li><li>ã€Œå…ƒç´ ï¼šabcï¼Œæƒé‡ï¼š3ã€èŠ‚ç‚¹çš„ leve[0] çš„ä¸‹ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘äº†ã€Œå…ƒç´ ï¼šabcdï¼Œæƒé‡ï¼š4ã€çš„èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹æ­£æ˜¯è¦æŸ¥æ‰¾çš„èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢ç»“æŸã€‚</li></ul><h2 id="è·³è¡¨èŠ‚ç‚¹å±‚æ•°è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#è·³è¡¨èŠ‚ç‚¹å±‚æ•°è®¾ç½®" aria-hidden="true">#</a> è·³è¡¨èŠ‚ç‚¹å±‚æ•°è®¾ç½®</h2><p>è·³è¡¨çš„ç›¸é‚»ä¸¤å±‚çš„èŠ‚ç‚¹æ•°é‡çš„æ¯”ä¾‹ä¼šå½±å“è·³è¡¨çš„æŸ¥è¯¢æ€§èƒ½ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹å›¾çš„è·³è¡¨ï¼Œç¬¬äºŒå±‚çš„èŠ‚ç‚¹æ•°é‡åªæœ‰ 1 ä¸ªï¼Œè€Œç¬¬ä¸€å±‚çš„èŠ‚ç‚¹æ•°é‡æœ‰ 6 ä¸ªã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724550.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>è¿™æ—¶ï¼Œå¦‚æœæƒ³è¦æŸ¥è¯¢èŠ‚ç‚¹ 6ï¼Œé‚£åŸºæœ¬å°±è·Ÿé“¾è¡¨çš„æŸ¥è¯¢å¤æ‚åº¦ä¸€æ ·ï¼Œå°±éœ€è¦åœ¨ç¬¬ä¸€å±‚çš„èŠ‚ç‚¹ä¸­ä¾æ¬¡é¡ºåºæŸ¥æ‰¾ï¼Œå¤æ‚åº¦å°±æ˜¯ O(N) äº†ã€‚æ‰€ä»¥ï¼Œä¸ºäº†é™ä½æŸ¥è¯¢å¤æ‚åº¦ï¼Œæˆ‘ä»¬å°±éœ€è¦ç»´æŒç›¸é‚»å±‚ç»“ç‚¹æ•°é—´çš„å…³ç³»ã€‚</p><p><strong>è·³è¡¨çš„ç›¸é‚»ä¸¤å±‚çš„èŠ‚ç‚¹æ•°é‡æœ€ç†æƒ³çš„æ¯”ä¾‹æ˜¯ 2:1ï¼ŒæŸ¥æ‰¾å¤æ‚åº¦å¯ä»¥é™ä½åˆ° O(logN)</strong>ã€‚</p><p>ä¸‹å›¾çš„è·³è¡¨å°±æ˜¯ï¼Œç›¸é‚»ä¸¤å±‚çš„èŠ‚ç‚¹æ•°é‡çš„æ¯”ä¾‹æ˜¯ 2 : 1ã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724779.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>é‚£æ€æ ·æ‰èƒ½ç»´æŒç›¸é‚»ä¸¤å±‚çš„èŠ‚ç‚¹æ•°é‡çš„æ¯”ä¾‹ä¸º 2 : 1 å‘¢ï¼Ÿ</p><p>å¦‚æœé‡‡ç”¨æ–°å¢èŠ‚ç‚¹æˆ–è€…åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œæ¥è°ƒæ•´è·³è¡¨èŠ‚ç‚¹ä»¥ç»´æŒæ¯”ä¾‹çš„æ–¹æ³•çš„è¯ï¼Œä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€ã€‚</p><p>Redis åˆ™é‡‡ç”¨ä¸€ç§å·§å¦™çš„æ–¹æ³•æ˜¯ï¼Œ<strong>è·³è¡¨åœ¨åˆ›å»ºèŠ‚ç‚¹çš„æ—¶å€™ï¼Œéšæœºç”Ÿæˆæ¯ä¸ªèŠ‚ç‚¹çš„å±‚æ•°</strong>ï¼Œå¹¶æ²¡æœ‰ä¸¥æ ¼ç»´æŒç›¸é‚»ä¸¤å±‚çš„èŠ‚ç‚¹æ•°é‡æ¯”ä¾‹ä¸º 2 : 1 çš„æƒ…å†µã€‚</p><p>å…·ä½“çš„åšæ³•æ˜¯ï¼Œ<strong>è·³è¡¨åœ¨åˆ›å»ºèŠ‚ç‚¹æ—¶å€™ï¼Œä¼šç”ŸæˆèŒƒå›´ä¸º[0-1]çš„ä¸€ä¸ªéšæœºæ•°ï¼Œå¦‚æœè¿™ä¸ªéšæœºæ•°å°äº 0.25ï¼ˆç›¸å½“äºæ¦‚ç‡ 25%ï¼‰ï¼Œé‚£ä¹ˆå±‚æ•°å°±å¢åŠ  1 å±‚ï¼Œç„¶åç»§ç»­ç”Ÿæˆä¸‹ä¸€ä¸ªéšæœºæ•°ï¼Œç›´åˆ°éšæœºæ•°çš„ç»“æœå¤§äº 0.25 ç»“æŸï¼Œæœ€ç»ˆç¡®å®šè¯¥èŠ‚ç‚¹çš„å±‚æ•°</strong>ã€‚</p><p>è¿™æ ·çš„åšæ³•ï¼Œç›¸å½“äºæ¯å¢åŠ ä¸€å±‚çš„æ¦‚ç‡ä¸è¶…è¿‡ 25%ï¼Œå±‚æ•°è¶Šé«˜ï¼Œæ¦‚ç‡è¶Šä½ï¼Œå±‚é«˜æœ€å¤§é™åˆ¶æ˜¯ 64ã€‚</p><p>è™½ç„¶æˆ‘å‰é¢è®²è§£è·³è¡¨çš„æ—¶å€™ï¼Œå›¾ä¸­çš„è·³è¡¨çš„ã€Œå¤´èŠ‚ç‚¹ã€éƒ½æ˜¯ 3 å±‚é«˜ï¼Œä½†æ˜¯å…¶å®<strong>å¦‚æœå±‚é«˜æœ€å¤§é™åˆ¶æ˜¯ 64ï¼Œé‚£ä¹ˆåœ¨åˆ›å»ºè·³è¡¨ã€Œå¤´èŠ‚ç‚¹ã€çš„æ—¶å€™ï¼Œå°±ä¼šç›´æ¥åˆ›å»º 64 å±‚é«˜çš„å¤´èŠ‚ç‚¹</strong>ã€‚</p><p>å¦‚ä¸‹ä»£ç ï¼Œåˆ›å»ºè·³è¡¨æ—¶ï¼Œå¤´èŠ‚ç‚¹çš„ level æ•°ç»„æœ‰ ZSKIPLIST_MAXLEVELä¸ªå…ƒç´ ï¼ˆå±‚ï¼‰ï¼ŒèŠ‚ç‚¹ä¸å­˜å‚¨ä»»ä½• member å’Œ score å€¼ï¼Œlevel æ•°ç»„å…ƒç´ çš„ forward éƒ½æŒ‡å‘NULLï¼Œ spanå€¼éƒ½ä¸º0ã€‚</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">/* Create a new skiplist. */</span>
zskiplist <span class="token operator">*</span><span class="token function">zslCreate</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> j<span class="token punctuation">;</span>
    zskiplist <span class="token operator">*</span>zsl<span class="token punctuation">;</span>

    zsl <span class="token operator">=</span> <span class="token function">zmalloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token operator">*</span>zsl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    zsl<span class="token operator">-&gt;</span>level <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    zsl<span class="token operator">-&gt;</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    zsl<span class="token operator">-&gt;</span>header <span class="token operator">=</span> <span class="token function">zslCreateNode</span><span class="token punctuation">(</span>ZSKIPLIST_MAXLEVEL<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> ZSKIPLIST_MAXLEVEL<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        zsl<span class="token operator">-&gt;</span>header<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>forward <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        zsl<span class="token operator">-&gt;</span>header<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>span <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    zsl<span class="token operator">-&gt;</span>header<span class="token operator">-&gt;</span>backward <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    zsl<span class="token operator">-&gt;</span>tail <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> zsl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼ŒZSKIPLIST_MAXLEVEL å®šä¹‰çš„æ˜¯æœ€é«˜çš„å±‚æ•°ï¼ŒRedis 7.0 å®šä¹‰ä¸º 32ï¼ŒRedis 5.0 å®šä¹‰ä¸º 64ï¼ŒRedis 3.0 å®šä¹‰ä¸º 32ã€‚</p><h2 id="ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ</h2><p>è¿™é‡Œæ’ä¸€ä¸ªå¸¸è§çš„é¢è¯•é¢˜ï¼šä¸ºä»€ä¹ˆ Zset çš„å®ç°ç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼ˆå¦‚ AVLæ ‘ã€çº¢é»‘æ ‘ç­‰ï¼‰ï¼Ÿ</p><p>ä¸»è¦æ˜¯ä»å†…å­˜å ç”¨ã€å¯¹èŒƒå›´æŸ¥æ‰¾çš„æ”¯æŒã€å®ç°éš¾æ˜“ç¨‹åº¦è¿™ä¸‰æ–¹é¢æ€»ç»“çš„åŸå› ï¼š</p><ul><li><strong>ä»å†…å­˜å ç”¨ä¸Šæ¥æ¯”è¾ƒï¼Œè·³è¡¨æ¯”å¹³è¡¡æ ‘æ›´çµæ´»ä¸€äº›</strong>ã€‚å¹³è¡¡æ ‘æ¯ä¸ªèŠ‚ç‚¹åŒ…å« 2 ä¸ªæŒ‡é’ˆï¼ˆåˆ†åˆ«æŒ‡å‘å·¦å³å­æ ‘ï¼‰ï¼Œè€Œè·³è¡¨æ¯ä¸ªèŠ‚ç‚¹åŒ…å«çš„æŒ‡é’ˆæ•°ç›®å¹³å‡ä¸º 1/(1-p)ï¼Œå…·ä½“å–å†³äºå‚æ•° p çš„å¤§å°ã€‚å¦‚æœåƒ Redisé‡Œçš„å®ç°ä¸€æ ·ï¼Œå– p=1/4ï¼Œé‚£ä¹ˆå¹³å‡æ¯ä¸ªèŠ‚ç‚¹åŒ…å« 1.33 ä¸ªæŒ‡é’ˆï¼Œæ¯”å¹³è¡¡æ ‘æ›´æœ‰ä¼˜åŠ¿ã€‚</li><li><strong>åœ¨åšèŒƒå›´æŸ¥æ‰¾çš„æ—¶å€™ï¼Œè·³è¡¨æ¯”å¹³è¡¡æ ‘æ“ä½œè¦ç®€å•</strong>ã€‚åœ¨å¹³è¡¡æ ‘ä¸Šï¼Œæˆ‘ä»¬æ‰¾åˆ°æŒ‡å®šèŒƒå›´çš„å°å€¼ä¹‹åï¼Œè¿˜éœ€è¦ä»¥ä¸­åºéå†çš„é¡ºåºç»§ç»­å¯»æ‰¾å…¶å®ƒä¸è¶…è¿‡å¤§å€¼çš„èŠ‚ç‚¹ã€‚å¦‚æœä¸å¯¹å¹³è¡¡æ ‘è¿›è¡Œä¸€å®šçš„æ”¹é€ ï¼Œè¿™é‡Œçš„ä¸­åºéå†å¹¶ä¸å®¹æ˜“å®ç°ã€‚è€Œåœ¨è·³è¡¨ä¸Šè¿›è¡ŒèŒƒå›´æŸ¥æ‰¾å°±éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨æ‰¾åˆ°å°å€¼ä¹‹åï¼Œå¯¹ç¬¬ 1 å±‚é“¾è¡¨è¿›è¡Œè‹¥å¹²æ­¥çš„éå†å°±å¯ä»¥å®ç°ã€‚</li><li><strong>ä»ç®—æ³•å®ç°éš¾åº¦ä¸Šæ¥æ¯”è¾ƒï¼Œè·³è¡¨æ¯”å¹³è¡¡æ ‘è¦ç®€å•å¾—å¤š</strong>ã€‚å¹³è¡¡æ ‘çš„æ’å…¥å’Œåˆ é™¤æ“ä½œå¯èƒ½å¼•å‘å­æ ‘çš„è°ƒæ•´ï¼Œé€»è¾‘å¤æ‚ï¼Œè€Œè·³è¡¨çš„æ’å…¥å’Œåˆ é™¤åªéœ€è¦ä¿®æ”¹ç›¸é‚»èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œæ“ä½œç®€å•åˆå¿«é€Ÿã€‚</li></ul><h1 id="quicklist" tabindex="-1"><a class="header-anchor" href="#quicklist" aria-hidden="true">#</a> quicklist</h1><p>åœ¨ Redis 3.0 ä¹‹å‰ï¼ŒList å¯¹è±¡çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯åŒå‘é“¾è¡¨æˆ–è€…å‹ç¼©åˆ—è¡¨ã€‚ç„¶ååœ¨ Redis 3.2 çš„æ—¶å€™ï¼ŒList å¯¹è±¡çš„åº•å±‚æ”¹ç”± quicklist æ•°æ®ç»“æ„å®ç°ã€‚</p><p>å…¶å® <strong>quicklist å°±æ˜¯ã€ŒåŒå‘é“¾è¡¨ + å‹ç¼©åˆ—è¡¨ã€ç»„åˆï¼Œå› ä¸ºä¸€ä¸ª quicklist å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œè€Œé“¾è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ åˆæ˜¯ä¸€ä¸ªå‹ç¼©åˆ—è¡¨ã€‚</strong></p><p>åœ¨å‰é¢è®²å‹ç¼©åˆ—è¡¨çš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿæåˆ°äº†å‹ç¼©åˆ—è¡¨çš„ä¸è¶³ï¼Œè™½ç„¶å‹ç¼©åˆ—è¡¨æ˜¯é€šè¿‡ç´§å‡‘å‹çš„å†…å­˜å¸ƒå±€èŠ‚çœäº†å†…å­˜å¼€é”€ï¼Œä½†æ˜¯å› ä¸ºå®ƒçš„ç»“æ„è®¾è®¡ï¼Œå¦‚æœä¿å­˜çš„å…ƒç´ æ•°é‡å¢åŠ ï¼Œæˆ–è€…å…ƒç´ å˜å¤§äº†ï¼Œå‹ç¼©åˆ—è¡¨ä¼šæœ‰ã€Œè¿é”æ›´æ–°ã€çš„é£é™©ï¼Œä¸€æ—¦å‘ç”Ÿï¼Œä¼šé€ æˆæ€§èƒ½ä¸‹é™ã€‚</p><p>quicklist è§£å†³åŠæ³•ï¼Œ<strong>é€šè¿‡æ§åˆ¶æ¯ä¸ªé“¾è¡¨èŠ‚ç‚¹ä¸­çš„å‹ç¼©åˆ—è¡¨çš„å¤§å°æˆ–è€…å…ƒç´ ä¸ªæ•°ï¼Œæ¥è§„é¿è¿é”æ›´æ–°çš„é—®é¢˜ã€‚å› ä¸ºå‹ç¼©åˆ—è¡¨å…ƒç´ è¶Šå°‘æˆ–è¶Šå°ï¼Œè¿é”æ›´æ–°å¸¦æ¥çš„å½±å“å°±è¶Šå°ï¼Œä»è€Œæä¾›äº†æ›´å¥½çš„è®¿é—®æ€§èƒ½ã€‚</strong></p><h2 id="quicklist-ç»“æ„è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#quicklist-ç»“æ„è®¾è®¡" aria-hidden="true">#</a> quicklist ç»“æ„è®¾è®¡</h2><p>quicklist çš„ç»“æ„ä½“è·Ÿé“¾è¡¨çš„ç»“æ„ä½“ç±»ä¼¼ï¼Œéƒ½åŒ…å«äº†è¡¨å¤´å’Œè¡¨å°¾ï¼ŒåŒºåˆ«åœ¨äº quicklist çš„èŠ‚ç‚¹æ˜¯ quicklistNodeã€‚</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">quicklist</span> <span class="token punctuation">{</span>
    <span class="token comment">//quicklistçš„é“¾è¡¨å¤´</span>
    quicklistNode <span class="token operator">*</span>head<span class="token punctuation">;</span>      <span class="token comment">//quicklistçš„é“¾è¡¨å¤´</span>
    <span class="token comment">//quicklistçš„é“¾è¡¨å°¾</span>
    quicklistNode <span class="token operator">*</span>tail<span class="token punctuation">;</span> 
    <span class="token comment">//æ‰€æœ‰å‹ç¼©åˆ—è¡¨ä¸­çš„æ€»å…ƒç´ ä¸ªæ•°</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> count<span class="token punctuation">;</span>
    <span class="token comment">//quicklistNodesçš„ä¸ªæ•°</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> len<span class="token punctuation">;</span>       
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span> quicklist<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥çœ‹çœ‹ï¼ŒquicklistNode çš„ç»“æ„å®šä¹‰ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">quicklistNode</span> <span class="token punctuation">{</span>
    <span class="token comment">//å‰ä¸€ä¸ªquicklistNode</span>
    <span class="token keyword">struct</span> <span class="token class-name">quicklistNode</span> <span class="token operator">*</span>prev<span class="token punctuation">;</span>     <span class="token comment">//å‰ä¸€ä¸ªquicklistNode</span>
    <span class="token comment">//ä¸‹ä¸€ä¸ªquicklistNode</span>
    <span class="token keyword">struct</span> <span class="token class-name">quicklistNode</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>     <span class="token comment">//åä¸€ä¸ªquicklistNode</span>
    <span class="token comment">//quicklistNodeæŒ‡å‘çš„å‹ç¼©åˆ—è¡¨</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>zl<span class="token punctuation">;</span>              
    <span class="token comment">//å‹ç¼©åˆ—è¡¨çš„çš„å­—èŠ‚å¤§å°</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> sz<span class="token punctuation">;</span>                
    <span class="token comment">//å‹ç¼©åˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> count <span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">;</span>        <span class="token comment">//ziplistä¸­çš„å…ƒç´ ä¸ªæ•° </span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span> quicklistNode<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼ŒquicklistNode ç»“æ„ä½“é‡ŒåŒ…å«äº†å‰ä¸€ä¸ªèŠ‚ç‚¹å’Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆï¼Œè¿™æ ·æ¯ä¸ª quicklistNode å½¢æˆäº†ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚ä½†æ˜¯é“¾è¡¨èŠ‚ç‚¹çš„å…ƒç´ ä¸å†æ˜¯å•çº¯ä¿å­˜å…ƒç´ å€¼ï¼Œè€Œæ˜¯ä¿å­˜äº†ä¸€ä¸ªå‹ç¼©åˆ—è¡¨ï¼Œæ‰€ä»¥ quicklistNode ç»“æ„ä½“é‡Œæœ‰ä¸ªæŒ‡å‘å‹ç¼©åˆ—è¡¨çš„æŒ‡é’ˆ *zlã€‚</p><p>æˆ‘ç”»äº†ä¸€å¼ å›¾ï¼Œæ–¹ä¾¿ä½ ç†è§£ quicklist æ•°æ®ç»“æ„ã€‚</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724889.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>åœ¨å‘ quicklist æ·»åŠ ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œä¸ä¼šåƒæ™®é€šçš„é“¾è¡¨é‚£æ ·ï¼Œç›´æ¥æ–°å»ºä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ã€‚è€Œæ˜¯ä¼š<strong>æ£€æŸ¥æ’å…¥ä½ç½®çš„å‹ç¼©åˆ—è¡¨æ˜¯å¦èƒ½å®¹çº³è¯¥å…ƒç´ </strong>ï¼Œå¦‚æœèƒ½å®¹çº³å°±ç›´æ¥ä¿å­˜åˆ° quicklistNode ç»“æ„é‡Œçš„å‹ç¼©åˆ—è¡¨ï¼Œå¦‚æœä¸èƒ½å®¹çº³ï¼Œæ‰ä¼šæ–°å»ºä¸€ä¸ªæ–°çš„ quicklistNode ç»“æ„ã€‚</p><p>quicklist ä¼šæ§åˆ¶ quicklistNode ç»“æ„é‡Œçš„å‹ç¼©åˆ—è¡¨çš„å¤§å°æˆ–è€…å…ƒç´ ä¸ªæ•°ï¼Œæ¥è§„é¿æ½œåœ¨çš„è¿é”æ›´æ–°çš„é£é™©ï¼Œä½†æ˜¯è¿™å¹¶æ²¡æœ‰å®Œå…¨è§£å†³è¿é”æ›´æ–°çš„é—®é¢˜ã€‚</p><h1 id="listpack" tabindex="-1"><a class="header-anchor" href="#listpack" aria-hidden="true">#</a> listpack</h1><p>quicklist è™½ç„¶é€šè¿‡æ§åˆ¶ quicklistNode ç»“æ„é‡Œçš„å‹ç¼©åˆ—è¡¨çš„å¤§å°æˆ–è€…å…ƒç´ ä¸ªæ•°ï¼Œæ¥å‡å°‘è¿é”æ›´æ–°å¸¦æ¥çš„æ€§èƒ½å½±å“ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å®Œå…¨è§£å†³è¿é”æ›´æ–°çš„é—®é¢˜ã€‚</p><p>å› ä¸º quicklistNode è¿˜æ˜¯ç”¨äº†å‹ç¼©åˆ—è¡¨æ¥ä¿å­˜å…ƒç´ ï¼Œå‹ç¼©åˆ—è¡¨è¿é”æ›´æ–°çš„é—®é¢˜ï¼Œæ¥æºäºå®ƒçš„ç»“æ„è®¾è®¡ï¼Œæ‰€ä»¥è¦æƒ³å½»åº•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦è®¾è®¡ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„ã€‚</p><p>äºæ˜¯ï¼ŒRedis åœ¨ 5.0 æ–°è®¾è®¡ä¸€ä¸ªæ•°æ®ç»“æ„å« <strong>listpackï¼Œç›®çš„æ˜¯æ›¿ä»£å‹ç¼©åˆ—è¡¨ï¼Œå®ƒæœ€å¤§ç‰¹ç‚¹æ˜¯ listpack ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸å†åŒ…å«å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦äº†ï¼Œå‹ç¼©åˆ—è¡¨æ¯ä¸ªèŠ‚ç‚¹æ­£å› ä¸ºéœ€è¦ä¿å­˜å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦å­—æ®µï¼Œå°±ä¼šæœ‰è¿é”æ›´æ–°çš„éšæ‚£ã€‚</strong></p><h2 id="listpack-ç»“æ„è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#listpack-ç»“æ„è®¾è®¡" aria-hidden="true">#</a> listpack ç»“æ„è®¾è®¡</h2><p>listpack é‡‡ç”¨äº†å‹ç¼©åˆ—è¡¨çš„å¾ˆå¤šä¼˜ç§€çš„è®¾è®¡ï¼Œæ¯”å¦‚<strong>è¿˜æ˜¯ç”¨ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´æ¥ç´§å‡‘åœ°ä¿å­˜æ•°æ®ï¼Œå¹¶ä¸”ä¸ºäº†èŠ‚çœå†…å­˜çš„å¼€é”€ï¼Œlistpack èŠ‚ç‚¹ä¼šé‡‡ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼ä¿å­˜ä¸åŒå¤§å°çš„æ•°æ®ã€‚</strong></p><p>æˆ‘ä»¬å…ˆçœ‹çœ‹ listpack ç»“æ„ï¼š</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724104.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>listpack å¤´åŒ…å«ä¸¤ä¸ªå±æ€§ï¼Œåˆ†åˆ«è®°å½•äº† listpack æ€»å­—èŠ‚æ•°å’Œå…ƒç´ æ•°é‡ï¼Œç„¶å listpack æœ«å°¾ä¹Ÿæœ‰ä¸ªç»“å°¾æ ‡è¯†ã€‚å›¾ä¸­çš„ listpack entry å°±æ˜¯ listpack çš„èŠ‚ç‚¹äº†ã€‚</p><p>æ¯ä¸ª listpack èŠ‚ç‚¹ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="https://raw.githubusercontent.com/huamus/picture-bed/main/img202307020724260.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ä¸»è¦åŒ…å«ä¸‰ä¸ªæ–¹é¢å†…å®¹ï¼š</p><ul><li>encodingï¼Œå®šä¹‰è¯¥å…ƒç´ çš„ç¼–ç ç±»å‹ï¼Œä¼šå¯¹ä¸åŒé•¿åº¦çš„æ•´æ•°å’Œå­—ç¬¦ä¸²è¿›è¡Œç¼–ç ï¼›</li><li>dataï¼Œå®é™…å­˜æ”¾çš„æ•°æ®ï¼›</li><li>lenï¼Œencoding+dataçš„æ€»é•¿åº¦ï¼›</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>listpack æ²¡æœ‰å‹ç¼©åˆ—è¡¨ä¸­è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦çš„å­—æ®µäº†ï¼Œlistpack åªè®°å½•å½“å‰èŠ‚ç‚¹çš„é•¿åº¦ï¼Œå½“æˆ‘ä»¬å‘ listpack åŠ å…¥ä¸€ä¸ªæ–°å…ƒç´ çš„æ—¶å€™ï¼Œä¸ä¼šå½±å“å…¶ä»–èŠ‚ç‚¹çš„é•¿åº¦å­—æ®µçš„å˜åŒ–ï¼Œä»è€Œé¿å…äº†å‹ç¼©åˆ—è¡¨çš„è¿é”æ›´æ–°é—®é¢˜</strong>ã€‚</p><hr><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li>ã€ŠRedisè®¾è®¡ä¸å®ç°ã€‹</li><li>ã€ŠRedis æºç å‰–æä¸å®æˆ˜ã€‹</li></ul><hr><h1 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h1><p>ç»ˆäºå®Œå·¥äº†ï¼Œæ¾ä¸€å£æ°”ã€‚</p><p>å¥½ä¹…æ²¡å†™é‚£ä¹ˆé•¿çš„å›¾è§£æŠ€æœ¯æ–‡å•¦ï¼Œè¿™æ¬¡æ½‡æ½‡æ´’æ´’å†™äº† 1.5 ä¸‡å­— + ç”»äº† 40 å¤šå¼ å›¾ï¼ŒèŠ±è´¹äº†ä¸å°‘æ—¶é—´ï¼Œåˆæ˜¯çœ‹ä¹¦ï¼Œåˆæ˜¯çœ‹æºç ã€‚</p><p>å¸Œæœ›è¿™ç¯‡æ–‡ç« ï¼Œèƒ½å¸®ä½ ç ´é™¤ Redis æ•°æ®ç»“æ„çš„è¿·é›¾ï¼</p><h1 id="è¯»è€…é—®ç­”" tabindex="-1"><a class="header-anchor" href="#è¯»è€…é—®ç­”" aria-hidden="true">#</a> è¯»è€…é—®ç­”</h1><p>å‹ç¼©åˆ—è¡¨çš„entryä¸ºä»€ä¹ˆè¦ä¿å­˜prevlenå‘¢ï¼Ÿlistpackæ”¹æˆlenä¹‹åä¸ä¼šå½±å“åŠŸèƒ½å—ï¼Ÿ</p><p>å‹ç¼©åˆ—è¡¨çš„ entry ä¿å­˜ prevlen æ˜¯ä¸ºäº†å®ç°èŠ‚ç‚¹ä»åå¾€å‰éå†ï¼ŒçŸ¥é“å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ï¼Œå°±å¯ä»¥è®¡ç®—å‰ä¸€ä¸ªèŠ‚ç‚¹çš„åç§»é‡ã€‚</p><p>listpack ä¸€æ ·å¯ä»¥æ”¯æŒä»åå¾€å‰éå†çš„ã€‚è¯¦ç»†çš„ç®—æ³•å¯ä»¥çœ‹ï¼š<a href="https://github.com/antirez/listpack/blob/master/listpack.c" target="_blank" rel="noopener noreferrer">https://github.com/antirez/listpack/blob/master/listpack.c<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> é‡Œçš„lpDecodeBacklenå‡½æ•°ï¼ŒlpDecodeBacklen å‡½æ•°å°±å¯ä»¥ä»å½“å‰åˆ—è¡¨é¡¹èµ·å§‹ä½ç½®çš„æŒ‡é’ˆå¼€å§‹ï¼Œå‘å·¦é€ä¸ªå­—èŠ‚è§£æï¼Œå¾—åˆ°å‰ä¸€é¡¹çš„ entry-len å€¼ã€‚</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/1.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 1943805462@qq.com">huamus</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><!----><a class="vp-link nav-link next" href="/myblogs/knowledgeBase/xiaolinCoding/4.Redis/3.dataTypeChapter/2.html"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">2. Redis å¸¸è§æ•°æ®ç±»å‹å’Œåº”ç”¨åœºæ™¯<!----></div></a></nav><div id="comment" class="waline-wrapper" darkmode="false" style="display:block;"><div data-waline provider="Waline"><!--v-if--><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="wl-nick">æ˜µç§°</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="wl-mail">é‚®ç®±</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="wl-link">ç½‘å€</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="è¯·ç•™è¨€ã€‚(å¡«å†™é‚®ç®±å¯åœ¨è¢«å›å¤æ—¶æ”¶åˆ°é‚®ä»¶æé†’)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>é¢„è§ˆ:</h4><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noopener noreferrer"><svg width="16" height="16" ariaHidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button type="button" class="wl-action" title="è¡¨æƒ…" style="display:none;"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button type="button" class="wl-action" title="è¡¨æƒ…åŒ…"><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="ä¸Šä¼ å›¾ç‰‡"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button type="button" class="wl-action" title="é¢„è§ˆ"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-captcha-container"></div><div class="wl-text-number">0 <!--v-if--> Â å­—</div><button type="button" class="wl-btn">ç™»å½•</button><button type="submit" class="primary wl-btn" title="Cmd|Ctrl + Enter"><!--[-->æäº¤<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="æœç´¢è¡¨æƒ…åŒ…"><!--v-if--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> è¯„è®º</div><ul class="wl-sort"><!--[--><li class="active">æŒ‰æ­£åº</li><li class="">æŒ‰å€’åº</li><li class="">æŒ‰çƒ­åº¦</li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><!--[--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><!--]--><div class="wl-power"> Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noopener noreferrer"> Waline </a> v2.15.5</div></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">é»˜è®¤é¡µè„š</div><div class="vp-copyright">Copyright Â© 2023 huamus</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/myblogs/assets/app-88eaaf34.js" defer></script>
  </body>
</html>
